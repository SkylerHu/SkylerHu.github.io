<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Skyler&#39;s Blog</title>
  
  <subtitle>No pains, No gains!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-28T01:44:26.276Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Skyler Hu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用Docker搭建VPN</title>
    <link href="http://yoursite.com/vpn-docker-or-ssh/"/>
    <id>http://yoursite.com/vpn-docker-or-ssh/</id>
    <published>2017-10-12T02:57:49.000Z</published>
    <updated>2019-09-28T01:44:26.276Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>若要申请VPS可使用这个<a href="http://www.digitalocean.com/?refcode=a80753a9aac2" target="_blank" rel="noopener">DigtalOcean</a>，会赠送你$10用于购买VPS。</p></blockquote><h4 id="通过SSH隧道翻墙"><a href="#通过SSH隧道翻墙" class="headerlink" title="通过SSH隧道翻墙"></a>通过SSH隧道翻墙</h4><p>本地执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -D -N 7777 root@host</span><br></pre></td></tr></table></figure></p><p>需要使用代理的地方，都设置proxy到 127.0.0.1:7777</p><p>浏览器可通过<code>SwitchyOmega</code>添加情景方式</p><pre><code>代理协议使用SOCKS5，代理服务器地址127.0.0.1，代理端口7777</code></pre><h3 id="使用Docker"><a href="#使用Docker" class="headerlink" title="使用Docker"></a>使用Docker</h3><p>要说安装，最简洁明了方便当然是试用<code>Docker</code>啦</p><p>安装Docker, 可根据自己系统参考<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">官网</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install docker.io  # Ubuntu 16.04为例的</span><br></pre></td></tr></table></figure></p><h4 id="l2tp"><a href="#l2tp" class="headerlink" title="l2tp"></a>l2tp</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull fcojean/l2tp-ipsec-vpn-server</span><br></pre></td></tr></table></figure><p>VERY IMPORTANT ! First, run this command on the Docker host to load the IPsec NETKEY kernel module:<br><code>sudo modprobe af_key</code></p><p>vim <code>/etc/docker/vpn.env</code>，添加内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VPN_IPSEC_PSK=0819</span><br><span class="line">VPN_USER_CREDENTIAL_LIST=[&#123;&quot;login&quot;:&quot;skyler&quot;,&quot;password&quot;:&quot;skyler&quot;&#125;,&#123;&quot;login&quot;:&quot;guest&quot;,&quot;password&quot;:&quot;guest&quot;&#125;]</span><br><span class="line">VPN_NETWORK_INTERFACE=eth0</span><br></pre></td></tr></table></figure></p><p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name l2tp-ipsec-vpn-server \</span><br><span class="line">    --env-file /etc/docker/vpn.env \</span><br><span class="line">    -p 500:500/udp \</span><br><span class="line">    -p 4500:4500/udp \</span><br><span class="line">    -v /lib/modules:/lib/modules:ro \</span><br><span class="line">    -d --privileged \</span><br><span class="line">    fcojean/l2tp-ipsec-vpn-server</span><br></pre></td></tr></table></figure></p><p>check检测运行状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it l2tp-ipsec-vpn-server ipsec status</span><br></pre></td></tr></table></figure></p><h4 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mritd/shadowsocks</span><br></pre></td></tr></table></figure><p>启动，可修改<code>18888</code>端口及<code>-m</code>(加密方式)、<code>-k</code>(用户名)的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dt --name shadowsocks -p 18888:18888 mritd/shadowsocks -s &quot;-s 0.0.0.0 -p 18888 -m rc4-md5 -k skyler --fast-open&quot;</span><br></pre></td></tr></table></figure></p><p>ss不使用Docker也很简单，查看Shadowsocks<a href="http://shadowsocks.org/en/download/servers.html" target="_blank" rel="noopener">官网</a></p><h3 id="附Terminal使用代理"><a href="#附Terminal使用代理" class="headerlink" title="附Terminal使用代理"></a>附Terminal使用代理</h3><p>vim <code>~/.zshrc</code>或者<code>~/.bashrc</code>添加<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> # proxy</span><br><span class="line">alias setproxy=&quot;export ALL_PROXY=socks5://127.0.0.1:7777&quot;</span><br><span class="line">alias unsetproxy=&quot;unset ALL_PROXY&quot;</span><br><span class="line">alias ip=&quot;curl -i http://ip.cn&quot;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br><span class="line">setproxy  # 设置代理</span><br><span class="line">unsetproxy  # 取消代理</span><br><span class="line">ip  # 可用此命令验证</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;若要申请VPS可使用这个&lt;a href=&quot;http://www.digitalocean.com/?refcode=a80753a9aac2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DigtalOcean&lt;/a&gt;，会赠送你$
      
    
    </summary>
    
    
      <category term="VPN, Liunx" scheme="http://yoursite.com/tags/VPN-Liunx/"/>
    
  </entry>
  
  <entry>
    <title>Mac使用Iterm2的正确姿势</title>
    <link href="http://yoursite.com/Mac-iTerm-note/"/>
    <id>http://yoursite.com/Mac-iTerm-note/</id>
    <published>2017-10-11T03:37:23.000Z</published>
    <updated>2019-09-28T01:44:26.275Z</updated>
    
    <content type="html"><![CDATA[<h4 id="iTerm2设置光标跳动"><a href="#iTerm2设置光标跳动" class="headerlink" title="iTerm2设置光标跳动"></a>iTerm2设置光标跳动</h4><p><code>Preferences &gt; Profiles &gt; Keys &gt;</code></p><p>修改配置项</p><p><code>⌥←</code> –&gt; <code>Send Escape Sequence</code> + <code>Esc+b</code></p><p><code>⌥→</code> –&gt; <code>Send Escape Sequence</code> + <code>Esc+f</code></p><h4 id="自定义zsh提示命令"><a href="#自定义zsh提示命令" class="headerlink" title="自定义zsh提示命令"></a>自定义zsh提示命令</h4><p>前提当然是试用zsh主题了<br>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gmserver() &#123;</span><br><span class="line">    ssh root@$1.$2.gengmei</span><br><span class="line">&#125;</span><br><span class="line">_gmserver() &#123;</span><br><span class="line">    _arguments &apos;-s[sort output]&apos; &apos;1:first arg:(backend gaia ascle ascle-mock backend-mock flagship artemis)&apos; &apos;:next arg:(dev dev1 test pre hotfix hotfix1)&apos;</span><br><span class="line">&#125;</span><br><span class="line">compdef _gmserver gmserver</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;iTerm2设置光标跳动&quot;&gt;&lt;a href=&quot;#iTerm2设置光标跳动&quot; class=&quot;headerlink&quot; title=&quot;iTerm2设置光标跳动&quot;&gt;&lt;/a&gt;iTerm2设置光标跳动&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Preferences &amp;gt; Profile
      
    
    </summary>
    
    
      <category term="Mac" scheme="http://yoursite.com/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Python学习笔记</title>
    <link href="http://yoursite.com/Python-note/"/>
    <id>http://yoursite.com/Python-note/</id>
    <published>2017-10-11T03:34:25.000Z</published>
    <updated>2019-09-28T01:44:26.276Z</updated>
    
    <content type="html"><![CDATA[<h4 id="根据Soure安装指定版本Python"><a href="#根据Soure安装指定版本Python" class="headerlink" title="根据Soure安装指定版本Python"></a>根据Soure安装指定版本Python</h4><p>遇到问题，安装完之后没有Pip</p><p>需要执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-ensurepip=upgrade</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p><p>其中<code>--with-ensurepip=upgrade</code> 很重要</p><h4 id="Python3-print中文"><a href="#Python3-print中文" class="headerlink" title="Python3 print中文"></a>Python3 print中文</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: arr  = [<span class="string">'我是中文'</span>, <span class="string">'好的'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: print(arr)</span><br><span class="line">[<span class="string">'我是中文'</span>, <span class="string">'好的'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: <span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: astr = json.dumps(arr)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: print(astr)</span><br><span class="line">[<span class="string">"\u6211\u662f\u4e2d\u6587"</span>, <span class="string">"\u597d\u7684"</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: print(astr.encode(<span class="string">'utf-8'</span>).decode(<span class="string">'unicode-escape'</span>))</span><br><span class="line">[<span class="string">"我是中文"</span>, <span class="string">"好的"</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: astr</span><br><span class="line">Out[<span class="number">7</span>]: <span class="string">'["\\u6211\\u662f\\u4e2d\\u6587", "\\u597d\\u7684"]'</span></span><br></pre></td></tr></table></figure><h4 id="git-pre-commit-md"><a href="#git-pre-commit-md" class="headerlink" title="git pre-commit.md"></a>git pre-commit.md</h4><p>需要提前 <code>pip install flake8</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$BYPASS&quot; ]; then exit 0; fi</span><br><span class="line"></span><br><span class="line">git diff --cached -- &apos;*.py&apos; | flake8 --max-line-length=119 --ignore=W391,E501,F401 --show-source --diff</span><br><span class="line"></span><br><span class="line">if [ $? -gt 0 ]; then</span><br><span class="line">    echo</span><br><span class="line">    echo &apos;--------&apos;</span><br><span class="line">    echo &apos;Lint check failed.&apos;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;根据Soure安装指定版本Python&quot;&gt;&lt;a href=&quot;#根据Soure安装指定版本Python&quot; class=&quot;headerlink&quot; title=&quot;根据Soure安装指定版本Python&quot;&gt;&lt;/a&gt;根据Soure安装指定版本Python&lt;/h4&gt;&lt;p&gt;遇到
      
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Django添加sql query log</title>
    <link href="http://yoursite.com/Django-add-sql-query-log/"/>
    <id>http://yoursite.com/Django-add-sql-query-log/</id>
    <published>2017-10-11T03:32:31.000Z</published>
    <updated>2019-09-28T01:44:26.275Z</updated>
    
    <content type="html"><![CDATA[<h3 id="在manage-py-shell中"><a href="#在manage-py-shell中" class="headerlink" title="在manage.py shell中"></a>在manage.py shell中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">l = logging.getLogger(&apos;django.db.backends&apos;)</span><br><span class="line">l.setLevel(logging.DEBUG)</span><br><span class="line">l.addHandler(logging.StreamHandler())</span><br></pre></td></tr></table></figure><h3 id="在console中"><a href="#在console中" class="headerlink" title="在console中"></a>在console中</h3><p>在<code>settings.py</code>中配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    &apos;loggers&apos;: &#123;</span><br><span class="line">        &apos;django.db.backends&apos;: &#123;</span><br><span class="line">            &apos;handlers&apos;: [&apos;console&apos;],  # Quiet by default!</span><br><span class="line">            &apos;propagate&apos;: False,</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">         &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;在manage-py-shell中&quot;&gt;&lt;a href=&quot;#在manage-py-shell中&quot; class=&quot;headerlink&quot; title=&quot;在manage.py shell中&quot;&gt;&lt;/a&gt;在manage.py shell中&lt;/h3&gt;&lt;figure class
      
    
    </summary>
    
    
      <category term="Django" scheme="http://yoursite.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Crontab定时任务表达式</title>
    <link href="http://yoursite.com/job-Crontab/"/>
    <id>http://yoursite.com/job-Crontab/</id>
    <published>2017-10-11T03:15:40.000Z</published>
    <updated>2019-09-28T01:44:26.276Z</updated>
    
    <content type="html"><![CDATA[<h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h4><p><code>秒 分钟    小时    日    月 星期    年</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">字段名                 允许的值                        允许的特殊字符  </span><br><span class="line">秒                    0-59                            , - * /  </span><br><span class="line">分                    0-59                            , - * /  </span><br><span class="line">小时                  0-23                            , - * /  </span><br><span class="line">日                    1-31                            , - * ? / L W C  </span><br><span class="line">月                    1-12 or JAN-DEC                 , - * /  </span><br><span class="line">周几                  1-7 or SUN-SAT                   , - * ? / L C #  </span><br><span class="line">年 (可选字段)          empty, 1970-2099                 , - * /</span><br></pre></td></tr></table></figure><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * ?  每隔5秒执行一次</span><br><span class="line">0 */1 * * * ?  每隔1分钟执行一次</span><br><span class="line">0 0 23 * * ?  每天23点执行一次</span><br><span class="line">0 0 1 * * ?  每天凌晨1点执行一次：</span><br><span class="line">0 0 1 1 * ?  每月1号凌晨1点执行一次</span><br><span class="line">0 0 23 L * ?  每月最后一天23点执行一次</span><br><span class="line">0 0 1 ? * L  每周星期天凌晨1点实行一次</span><br><span class="line">0 26,29,33 * * * ?  在26分、29分、33分执行一次</span><br><span class="line">0 0 0,13,18,21 * * ? 每天的0点、13点、18点、21点都执行一次</span><br></pre></td></tr></table></figure><h4 id="Month"><a href="#Month" class="headerlink" title="Month"></a>Month</h4><p>一年中的几月：可以用0-11 或用字符串 “JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV and DEC” 表示</p><h4 id="Day-of-Week"><a href="#Day-of-Week" class="headerlink" title="Day-of-Week"></a>Day-of-Week</h4><p>每周：数字1-7（1 ＝ 星期日），或用字符口串“SUN, MON, TUE, WED, THU, FRI and SAT”</p><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* ：代表整个时间段</span><br><span class="line">“?”字符：表示不确定的值</span><br><span class="line">“,”字符：指定数个值</span><br><span class="line">“-”字符：指定一个值的范围</span><br><span class="line">“/”字符：指定一个值的增加幅度。n/m表示从n开始，每次增加m</span><br><span class="line">“L”字符：用在日表示一个月中的最后一天，用在周表示该月最后一个星期X</span><br><span class="line">“W”字符：指定离给定日期最近的工作日(周一到周五)</span><br><span class="line">“#”字符：表示该月第几个周X。6#3表示该月第3个周五</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h4&gt;&lt;p&gt;&lt;code&gt;秒 分钟    小时    日    月 
星期    年&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highligh
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令awk</title>
    <link href="http://yoursite.com/linux-shell-awk/"/>
    <id>http://yoursite.com/linux-shell-awk/</id>
    <published>2017-01-10T12:36:33.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h3><p>awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。</p><p>awk的处理文本和数据的方式：它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。</p><p>awk分别代表其作者姓氏的第一个字母。因为它的作者是三个人，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。</p><p>gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面介绍的awk是以GUN的gawk为例的，在linux系统中已把awk链接到gawk，所以下面全部以awk进行介绍。</p><h3 id="二、使用"><a href="#二、使用" class="headerlink" title="二、使用"></a>二、使用</h3><p><code>awk [-F  field-separator]  &#39;commands&#39;  input-file(s)</code><br>其中，[-F域分隔符]是可选的，commands 是真正awk命令。 input-file(s) 是待处理的文件。<br>在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。</p><h3 id="三、模式"><a href="#三、模式" class="headerlink" title="三、模式"></a>三、模式</h3><ol><li>正则表达式：使用通配符的扩展集。</li><li>关系表达式：可以用下面运算符表中的关系运算符进行操作</li><li>可以是字符串或数字的比较，如$2&gt;%1选择第二个字段比第一个字段长的行。</li><li>模式匹配表达式：用运算符~(匹配)和~!(不匹配)。</li><li>模式，模式：指定一个行的范围。该语法不能包括BEGIN和END模式。</li><li>BEGIN：让用户指定在第一条输入记录被处理之前所发生的动作，通常可在这里设置全局变量。</li><li>END：让用户在最后一条输入记录被读取之后发生的动作。</li></ol><h3 id="四、常量"><a href="#四、常量" class="headerlink" title="四、常量"></a>四、常量</h3><table><thead><tr><th>常量名</th><th>含义</th></tr></thead><tbody><tr><td>$n</td><td>当前记录的第n个字段，字段间由FS分隔</td></tr><tr><td>$0</td><td>完整的输入记录</td></tr><tr><td>NF</td><td>浏览记录的域的个数</td></tr><tr><td>NR</td><td>已读的记录数</td></tr><tr><td>ARGC</td><td>命令行参数个数</td></tr><tr><td>ARGV</td><td>命令行参数排列</td></tr><tr><td>ENVIRON</td><td>支持队列中系统环境变量的使用</td></tr><tr><td>FILENAME</td><td>awk浏览的文件名</td></tr><tr><td>FNR</td><td>浏览文件的记录数</td></tr><tr><td>FS</td><td>设置输入域分隔符，等价于命令行 -F选项</td></tr><tr><td>OFS</td><td>输出域分隔符</td></tr><tr><td>ORS</td><td>输出记录分隔符</td></tr><tr><td>RS</td><td>控制记录分隔符</td></tr></tbody></table><h3 id="五、常用函数"><a href="#五、常用函数" class="headerlink" title="五、常用函数"></a>五、常用函数</h3><h6 id="1-求和"><a href="#1-求和" class="headerlink" title="1. 求和"></a>1. 求和</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data | awk '&#123;sum+=$1&#125; END &#123;print "Sum = ", sum&#125;'</span><br></pre></td></tr></table></figure><h6 id="2-求平均"><a href="#2-求平均" class="headerlink" title="2. 求平均"></a>2. 求平均</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data | awk '&#123;sum+=$1&#125; END &#123;print "Average = ", sum/NR&#125;'</span><br></pre></td></tr></table></figure><h6 id="3-求最大值"><a href="#3-求最大值" class="headerlink" title="3. 求最大值"></a>3. 求最大值</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data | awk 'BEGIN &#123;max = 0&#125; &#123;if ($1&gt;max) max=$1 fi&#125; END &#123;print "Max=", max&#125;'</span><br></pre></td></tr></table></figure><h6 id="4-求最小值（min的初始值设置一个超大数即可）"><a href="#4-求最小值（min的初始值设置一个超大数即可）" class="headerlink" title="4. 求最小值（min的初始值设置一个超大数即可）"></a>4. 求最小值（min的初始值设置一个超大数即可）</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data | awk 'BEGIN &#123;min = 1999999&#125; &#123;if ($1&lt;min) min=$1 fi&#125; END &#123;print "Min=", min&#125;'</span><br></pre></td></tr></table></figure><h6 id="5-去重"><a href="#5-去重" class="headerlink" title="5. 去重"></a>5. 去重</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F':' '!a[$1]++'</span><br></pre></td></tr></table></figure><h6 id="6-输入统计结果"><a href="#6-输入统计结果" class="headerlink" title="6. 输入统计结果"></a>6. 输入统计结果</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data | awk 'info[$0]=++a[$12] &#123;&#125; END &#123;print "TotalCount = ", NR; for(i in info)&#123;print i, info[i]&#125; &#125;'</span><br></pre></td></tr></table></figure><p>还可以结合 <code>grep</code>/<code>uniq</code>(去重)/<code>sort</code>(排序)等命令一起使用</p><h5 id="六、Demo"><a href="#六、Demo" class="headerlink" title="六、Demo"></a>六、Demo</h5><p>当前目录下有三个log文件如下<br>log1.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation skyler</span><br><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation hu</span><br><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation hu</span><br><span class="line">2016-11-29 17:12:12,434 GET /api/web/tag -</span><br></pre></td></tr></table></figure></p><p>log2.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2016-11-29 17:08:19,794 GET /api/web/account/user huleping</span><br><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation skyler</span><br><span class="line">2016-11-29 17:08:19,794 GET /api/web/account/user skyler</span><br></pre></td></tr></table></figure></p><p>log3.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2016-11-29 17:12:23,462 GET /api/web/conversation skyler</span><br><span class="line">2016-11-29 17:12:30,459 GET /api/web/activity huleping</span><br><span class="line">2016-11-29 17:12:30,474 GET /api/web/conversation huleping</span><br></pre></td></tr></table></figure></p><p>查找出匹配结果相同的结果，然后根据用户id去重统计个数，并输出总数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ for i in $(seq 1 3); do grep "/api/web/conversation" log$&#123;i&#125;.txt; done | awk '!a[$5]++ END &#123;print "TotalCount = ", NR; for(i in a)&#123;print i, a[i] | "sort -r -n -k2";&#125; &#125;'</span><br><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation skyler</span><br><span class="line">2016-11-29 17:10:41,967 GET /api/web/conversation hu</span><br><span class="line">2016-11-29 17:12:30,474 GET /api/web/conversation huleping</span><br><span class="line">TotalCount =  6</span><br><span class="line">skyler 3</span><br><span class="line">hu 2</span><br><span class="line">huleping 1</span><br></pre></td></tr></table></figure></p><hr><p><em><code>seq</code> 用于产生从某个数到另外一个数之间的所有整数</em><br><em><a href="http://man.linuxde.net/sort" target="_blank" rel="noopener">sort用法说明</a></em><br><em>n是按照数字大小排序，-r是以相反顺序，-k是指定需要爱排序的栏位，-t指定栏位分隔符为冒号</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;一、简介&quot;&gt;&lt;a href=&quot;#一、简介&quot; class=&quot;headerlink&quot; title=&quot;一、简介&quot;&gt;&lt;/a&gt;一、简介&lt;/h3&gt;&lt;p&gt;awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Shell" scheme="http://yoursite.com/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Android Studio查看项目所有依赖的lib</title>
    <link href="http://yoursite.com/as-show-project-libs-info/"/>
    <id>http://yoursite.com/as-show-project-libs-info/</id>
    <published>2016-12-29T11:26:38.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>添加task<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">//显示所有依赖包的存储路径以及版本</span><br><span class="line">task showLibInfo &lt;&lt; &#123;</span><br><span class="line">    configurations.compile.each &#123; println it &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后在项目目录下执行task<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew showLibInfo</span><br></pre></td></tr></table></figure></p><p>输出结果就可以看到项目所有依赖的lib信息了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;添加task&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;b
      
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>清除项目所有pyc文件</title>
    <link href="http://yoursite.com/python-clear-pyc/"/>
    <id>http://yoursite.com/python-clear-pyc/</id>
    <published>2016-12-26T06:39:00.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>清除python项目所有pyc文件<br>用python去写一个项目，难免有时候需要处理清除pyc文件，于是写了个脚本，</p></blockquote><p>可以传入一个文件夹参数，表示需要清理的文件夹<br>默认取当前执行的文件夹路径</p><p>脚本具体如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Date:2011-03-26</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import fnmatch</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def clearpyc(root, patterns=<span class="string">'*'</span>, single_level=False, yield_folders=False):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    root: 需要遍历的目录</span></span><br><span class="line"><span class="string">    patterns： 需要查找的文件，以；为分割的字符串</span></span><br><span class="line"><span class="string">    single_level: 是否只遍历单层目录，默认为否</span></span><br><span class="line"><span class="string">    yield_folders: 是否包含目录本身，默认为否</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    patterns = patterns.split(<span class="string">';'</span>)</span><br><span class="line">    <span class="keyword">for</span> path, subdirs, files <span class="keyword">in</span> os.walk(root):</span><br><span class="line">        <span class="keyword">if</span> yield_folders:</span><br><span class="line">            files.extend(subdirs)</span><br><span class="line">            files.sort()</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">for</span> pattern <span class="keyword">in</span> patterns:</span><br><span class="line">                <span class="keyword">if</span> fnmatch.fnmatch(name, pattern.strip()):  <span class="comment"># 去除pattern两端的空格</span></span><br><span class="line">                    yield os.path.join(path, name)</span><br><span class="line">        <span class="keyword">if</span> single_level:</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> 2 == len(sys.argv):</span><br><span class="line">        directory = os.path.join(os.getcwd(), sys.argv[1])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"参数检查正确"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        directory = os.getcwd()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"取当前目录"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(directory)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> clearpyc(directory, <span class="string">'*.pyc'</span>):</span><br><span class="line">        <span class="built_in">print</span>(path)</span><br><span class="line">        os.remove(path)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;清除python项目所有pyc文件&lt;br&gt;用python去写一个项目，难免有时候需要处理清除pyc文件，于是写了个脚本，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以传入一个文件夹参数，表示需要清理的文件夹&lt;br&gt;默认取当前执行的文件夹路径&lt;/p
      
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>为终端Terminal设置Shadowsocks代理</title>
    <link href="http://yoursite.com/terminal-set-shadowsocks/"/>
    <id>http://yoursite.com/terminal-set-shadowsocks/</id>
    <published>2016-12-16T04:54:36.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>Shadowsocks是我们常用的代理工具，它使用socks5协议，而终端很多工具目前只支持http和https等协议，对socks5协议支持不够好，所以我们为终端设置shadowsocks的思路就是将socks协议转换成http协议，然后为终端设置即可。仔细想想也算是适配器模式的一种现实应用吧。</p><p>想要进行转换，需要借助工具，这里我们采用比较知名的polipo来实现。polipo是一个轻量级的缓存web代理程序。闲话休叙，让我们开始动手吧。</p><p><a href="http://pages.skylerhu.com/Shadowsocks-SwitchySharp/" target="_blank" rel="noopener">Shadowsocks的安装与使用</a>参考链接，点击访问</p><p>以下我是在Mac上配置的方式，其他系统可模仿。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install polipo  <span class="comment"># brew没安装的同学自行安装</span></span><br></pre></td></tr></table></figure><h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><p>设置每次登陆启动polipo<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/polipo/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure></p><p>修改文件<code>/usr/local/opt/polipo/homebrew.mxcl.polipo.plist</code>设置parentProxy<br>增加了 <code>&lt;string&gt;socksParentProxy=localhost:1080&lt;/string&gt;</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.polipo<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/usr/local/opt/polipo/bin/polipo<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>socksParentProxy=localhost:1080<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Set `ulimit -n 20480`. The default OS X limit is 256, that's</span></span><br><span class="line"><span class="comment">         not enough for Polipo (displays 'too many files open' errors).</span></span><br><span class="line"><span class="comment">         It seems like you have no reason to lower this limit</span></span><br><span class="line"><span class="comment">         (and unlikely will want to raise it). --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SoftResourceLimits<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>NumberOfFiles<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">integer</span>&gt;</span>20480<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.polipo.plis</span><br></pre></td></tr></table></figure><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p>两个语句执行的结果，显示ip地址不一样<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl ip.gs</span><br><span class="line">http_proxy=http://localhost:8123 curl ip.gs</span><br></pre></td></tr></table></figure></p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>编辑<code>~/.bash_profile</code>设置别名, 编辑之后执行<code>source ~/.bash_profile</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias use_ss="export http_proxy=http://localhost:8123 &amp;&amp; export https_proxy=http://localhost:8123"</span><br></pre></td></tr></table></figure></p><p>执行命令<code>use_ss</code>就可以使用了, 根据之下命令执行结果可验证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl ip.gs</span><br><span class="line">use_ss</span><br><span class="line">curl ip.gs</span><br></pre></td></tr></table></figure></p><p>本文编写<a href="http://droidyue.com/blog/2016/04/04/set-shadowsocks-proxy-for-terminal/index.html" target="_blank" rel="noopener">参考</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Shadowsocks是我们常用的代理工具，它使用socks5协议，而终端很多工具目前只支持http和https等协议，对socks5协议支持不够好，所以我们为终端设置shadowsocks的思路就是将socks协议转换成http协议，然后为终端设置即可。仔细想想也算是适配
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Shadowsocks" scheme="http://yoursite.com/tags/Shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>Android自定义小红点BadgeView</title>
    <link href="http://yoursite.com/android-badge-view/"/>
    <id>http://yoursite.com/android-badge-view/</id>
    <published>2016-12-16T02:59:54.000Z</published>
    <updated>2019-09-28T01:53:34.529Z</updated>
    
    <content type="html"><![CDATA[<p>想全局统一个小红点样式，总是改了这个忘了其他的，而且小红点格式各样，总是满足不了自己的需求，所以心血来潮自己自定义View onDraw了一个。</p><p>可前往查看<a href="https://github.com/SkylerHu/BadgeView" target="_blank" rel="noopener">GitHub源码</a>.</p><p>效果就是这样….</p><p><img src="http://blog-img.skylerhu.com/gif/blog/BadgeView_preview.gif" alt="BadgeView_preview.gif"></p><p>一定要记得在<code>attrs.xml</code> 项目中添加</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"BadgeView"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"iconSrc"</span> <span class="attr">format</span>=<span class="string">"reference"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"iconWidth"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"iconHeight"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--若是icon是正方形的,可直接设置这个参数--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"iconSize"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">format</span>=<span class="string">"string"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"textSize"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"textColor"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeNum"</span> <span class="attr">format</span>=<span class="string">"integer"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否显示数字, 为false时只显示小红点; 没有数字时,小红点的大小通过badgeSize设置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"showNum"</span> <span class="attr">format</span>=<span class="string">"boolean"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeBackgroundColor"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--限制设置小红点的大小不能超过数字显示模式(代码中也做了限制); 显示在文字模式大小的左下角;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不显示数字时, 小红点的大小, 不包括边线--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeRedSize"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeNumSize"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeNumColor"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--若小红点有边缘线,加上边缘线--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeBorderColor"</span> <span class="attr">format</span>=<span class="string">"color"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeBorderWidth"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--badge相对于主体右上角的相对位置, 重叠的部分的大小; 可以设置负值--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--默认是( badgeHeight/2 ), 正好覆盖一个角--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeBottom"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeLeft"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 有些设计要求未读前面加"+", (至少我们设计师这么设计) 显示成 +1/+34/+99--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"badgeNumPre"</span> <span class="attr">format</span>=<span class="string">"string"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="主要代码如下："><a href="#主要代码如下：" class="headerlink" title="主要代码如下："></a>主要代码如下：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadgeView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////可设置部分 start///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// 主体部分的设置  icon</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> iconSrc;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> iconWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> iconHeight;</span><br><span class="line">    <span class="comment">// 没有icon 就是文字描述了; icon的优先级比text高</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> textColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> textSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 未读数; 在显示的时候 未读数默认显示形式9/23/99+</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> badgeNum;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> badgeBackgroundColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> badgeNumColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeNumSize;</span><br><span class="line">    <span class="comment">// 是否显示数字, 默认显示小红点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> showNum;</span><br><span class="line">    <span class="comment">// 不显示数字时, 小红点的大小, 不包括边线</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeRedSize;</span><br><span class="line">    <span class="comment">// 边线, 有些小红点外边有白边, 若是设置了宽度,则会添加边线; 边线算在Badge整个的大小当中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeBorderWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> badgeBorderColor;</span><br><span class="line">    <span class="comment">// 有些设计要求未读前面加"+", (至少我们设计师这么设计) 显示成 +1/+34/+99</span></span><br><span class="line">    <span class="keyword">private</span> String badgeNumPre;</span><br><span class="line">    <span class="comment">// badge的左下角 相对于 text/icon 右上角的相对位置,</span></span><br><span class="line">    <span class="comment">// 默认是( badgeHeight/2 ), 正好覆盖一个角</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeBottom;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeLeft;</span><br><span class="line">    <span class="comment">// 是否自己设置了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasBadgeBottomAttr;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasBadgeLeftAttr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// view设置的padding</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewPaddingLeft;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewPaddingTop;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewPaddingRight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewPaddingBootom;</span><br><span class="line">    <span class="comment">////可设置部分 end///////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小红点真实大小 比 文本 的margin(不包括白边)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BADGE_TEXT_MARGIN_LEFT = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BADGE_TEXT_MARGIN_TOP = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BADGE_TEXT_MARGIN_RIGHT = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BADGE_TEXT_MARGIN_BOOTOM = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以设置padding</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VIEW_PADDING = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////以下是辅助变量///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// 整个View的真实大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewWidth;</span><br><span class="line">    <span class="comment">// 内容所占的大小, 内容居中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewMinHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> viewMinWidth;</span><br><span class="line">    <span class="comment">// 小红点有向右突出部分,为保证主体部分水平居中, 需要设置两边的margin</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mainMarginHorizontal;</span><br><span class="line">    <span class="comment">// 小红点有向上突出部分,就算没有未读数,也需要预留出位置, 设置Top即可</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mainMarginTop;</span><br><span class="line">    <span class="comment">// 描述文字或者icon的宽高</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mainWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mainHeight;</span><br><span class="line">    <span class="comment">// badge的整体宽高</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeWidth;</span><br><span class="line">    <span class="comment">// badgeNum/小红点 的真实宽高</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeNumHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> badgeNumWidth;</span><br><span class="line">    <span class="comment">// icon</span></span><br><span class="line">    <span class="keyword">private</span> Bitmap iconBitmap;</span><br><span class="line">    <span class="comment">// 未读数显示的文案; 未读数默认显示形式9/23/99+</span></span><br><span class="line">    <span class="keyword">private</span> String showUneadText;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 画笔</span></span><br><span class="line">    <span class="keyword">private</span> Paint contentPaint;</span><br><span class="line">    <span class="keyword">private</span> TextPaint textPaint;</span><br><span class="line">    <span class="keyword">private</span> TextPaint badgeNumPaint;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BadgeView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BadgeView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BadgeView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        TypedArray array = context.obtainStyledAttributes(attrs, R.styleable.BadgeView);</span><br><span class="line"></span><br><span class="line">        iconSrc = array.getResourceId(R.styleable.BadgeView_iconSrc, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">float</span> iconSize = array.getDimension(R.styleable.BadgeView_iconSize, dip2px(<span class="number">30</span>));</span><br><span class="line">        iconWidth = array.getDimension(R.styleable.BadgeView_iconWidth, iconSize);</span><br><span class="line">        iconHeight = array.getDimension(R.styleable.BadgeView_iconHeight, iconSize);</span><br><span class="line"></span><br><span class="line">        text = array.getString(R.styleable.BadgeView_text);</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(text)) &#123;</span><br><span class="line">            text = <span class="string">"Hello World"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        textColor = array.getColor(R.styleable.BadgeView_textColor, Color.BLACK);</span><br><span class="line">        textSize = array.getDimension(R.styleable.BadgeView_textSize, sp2px(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">        badgeNum = array.getInteger(R.styleable.BadgeView_badgeNum, <span class="number">0</span>);</span><br><span class="line">        badgeBackgroundColor = array.getColor(R.styleable.BadgeView_badgeBackgroundColor, Color.rgb(<span class="number">0xFF</span>, <span class="number">0x76</span>, <span class="number">0x90</span>));</span><br><span class="line">        badgeNumColor = array.getColor(R.styleable.BadgeView_badgeNumColor, Color.WHITE);</span><br><span class="line">        badgeNumSize = array.getDimension(R.styleable.BadgeView_badgeNumSize, sp2px(<span class="number">10</span>));</span><br><span class="line">        badgeNumSize = array.getDimension(R.styleable.BadgeView_badgeNumSize, sp2px(<span class="number">10</span>));</span><br><span class="line">        showNum = array.getBoolean(R.styleable.BadgeView_showNum, <span class="keyword">true</span>);</span><br><span class="line">        badgeRedSize = array.getDimension(R.styleable.BadgeView_badgeRedSize, dip2px(<span class="number">8</span>));</span><br><span class="line">        badgeBorderColor = array.getColor(R.styleable.BadgeView_badgeBorderColor, Color.WHITE);</span><br><span class="line">        badgeBorderWidth = array.getDimension(R.styleable.BadgeView_badgeBorderWidth, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (badgeBorderWidth &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            badgeBorderWidth = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        badgeNumPre = array.getString(R.styleable.BadgeView_badgeNumPre);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化badgeNum的画笔</span></span><br><span class="line">        badgeNumPaint = <span class="keyword">new</span> TextPaint();</span><br><span class="line">        badgeNumPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">        badgeNumPaint.setColor(badgeNumColor);</span><br><span class="line">        badgeNumPaint.setTextSize(badgeNumSize);</span><br><span class="line">        badgeNumPaint.setTextAlign(Paint.Align.CENTER);</span><br><span class="line">        <span class="comment">// 计算 未读数的高度</span></span><br><span class="line">        String minBadge = getUnreadText(<span class="number">0</span>);</span><br><span class="line">        Rect minBadgeRect = <span class="keyword">new</span> Rect();</span><br><span class="line">        badgeNumPaint.getTextBounds(minBadge, <span class="number">0</span>, minBadge.length(), minBadgeRect);</span><br><span class="line">        <span class="comment">// 计算badge的高度</span></span><br><span class="line">        badgeNumHeight = minBadgeRect.height();</span><br><span class="line">        badgeHeight = badgeNumHeight + BADGE_TEXT_MARGIN_TOP + BADGE_TEXT_MARGIN_BOOTOM + badgeBorderWidth * <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 限制设置小红点的大小不能超过数字显示模式; 显示在文字模式大小的左下角</span></span><br><span class="line">        <span class="keyword">if</span> (badgeRedSize &gt; badgeNumHeight + BADGE_TEXT_MARGIN_TOP + BADGE_TEXT_MARGIN_BOOTOM) &#123;</span><br><span class="line">            badgeRedSize = badgeNumHeight + BADGE_TEXT_MARGIN_TOP + BADGE_TEXT_MARGIN_BOOTOM;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取位置</span></span><br><span class="line">        hasBadgeBottomAttr = array.hasValue(R.styleable.BadgeView_badgeBottom);</span><br><span class="line">        hasBadgeLeftAttr = array.hasValue(R.styleable.BadgeView_badgeLeft);</span><br><span class="line">        badgeBottom = array.getDimension(R.styleable.BadgeView_badgeBottom, <span class="number">0</span>);</span><br><span class="line">        badgeLeft = array.getDimension(R.styleable.BadgeView_badgeLeft,  <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//关闭清空TypedArray</span></span><br><span class="line">        array.recycle();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化主体文字描述的画笔</span></span><br><span class="line">        textPaint = <span class="keyword">new</span> TextPaint();</span><br><span class="line">        textPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">        textPaint.setColor(textColor);</span><br><span class="line">        textPaint.setTextSize(textSize);</span><br><span class="line">        textPaint.setTextAlign(Paint.Align.CENTER);</span><br><span class="line"></span><br><span class="line">        contentPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        contentPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBadgeNum</span><span class="params">(<span class="keyword">int</span> badgeNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.badgeNum = badgeNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShowNum</span><span class="params">(<span class="keyword">boolean</span> isShow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.showNum = isShow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIconSrc</span><span class="params">(<span class="keyword">int</span> res)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.iconSrc = res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBadgeLocation</span><span class="params">(<span class="keyword">float</span> bottom, <span class="keyword">float</span> left)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.badgeBottom = bottom;</span><br><span class="line">        <span class="keyword">this</span>.badgeLeft = left;</span><br><span class="line">        hasBadgeBottomAttr = <span class="keyword">true</span>;</span><br><span class="line">        hasBadgeLeftAttr = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重新计算绘制这个View</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 需要重新计算高宽,所以用这个</span></span><br><span class="line">        requestLayout();</span><br><span class="line"><span class="comment">//        invalidate();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (viewWidth != viewMinWidth || viewHeight != viewMinHeight) &#123;</span><br><span class="line">            canvas.save();</span><br><span class="line">            <span class="comment">// 若是设置的高宽大于所需要的高宽, 对画布进行操作</span></span><br><span class="line">            <span class="keyword">float</span> paddingLeft = viewPaddingLeft + (viewWidth - viewPaddingLeft - viewPaddingRight - viewMinWidth) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">float</span> paddingTop = viewPaddingTop + (viewHeight -viewPaddingTop -viewPaddingBootom - viewMinHeight) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 移动布局, 改变原点</span></span><br><span class="line">            canvas.translate(paddingLeft, paddingTop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        onDrawContent(canvas);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (viewWidth != viewMinWidth || viewHeight != viewMinHeight) &#123;</span><br><span class="line">            canvas.restore();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绘制整个内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> canvas</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onDrawContent</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (iconSrc != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 画icon</span></span><br><span class="line">            canvas.drawBitmap(iconBitmap, mainMarginHorizontal + (mainWidth - iconWidth) / <span class="number">2</span>, mainMarginTop + (mainHeight - iconHeight) / <span class="number">2</span>, contentPaint);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 写text, 文字是居中的</span></span><br><span class="line">            canvas.drawText(text, viewMinWidth / <span class="number">2</span>, viewMinHeight, textPaint);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (badgeNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            canvas.save();</span><br><span class="line">            <span class="comment">// 移动布局, 改变原点</span></span><br><span class="line">            canvas.translate(viewMinWidth - badgeWidth, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            oDrawBadge(canvas);</span><br><span class="line"></span><br><span class="line">            canvas.restore();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">oDrawBadge</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 若有小红点有边缘线, 画边缘线</span></span><br><span class="line">        <span class="keyword">if</span> (badgeBorderWidth &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            contentPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">            contentPaint.setColor(badgeBorderColor);</span><br><span class="line">            contentPaint.setStrokeWidth(badgeBorderWidth);</span><br><span class="line">            <span class="keyword">if</span> (!showNum) &#123;</span><br><span class="line">                <span class="comment">// 不显示数字</span></span><br><span class="line">                canvas.drawCircle(badgeWidth / <span class="number">2</span>, badgeHeight - badgeRedSize / <span class="number">2</span> - badgeBorderWidth, badgeRedSize / <span class="number">2</span>, contentPaint);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (badgeWidth == badgeHeight) &#123;</span><br><span class="line">                <span class="comment">// 显示是字符串长度为1时, 为正圆</span></span><br><span class="line">                canvas.drawCircle(badgeWidth / <span class="number">2</span>, badgeHeight / <span class="number">2</span>, badgeWidth / <span class="number">2</span>, contentPaint);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 椭圆</span></span><br><span class="line">                Path borderPath = <span class="keyword">new</span> Path();</span><br><span class="line">                borderPath.addArc(<span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, badgeHeight, badgeHeight), <span class="number">90</span>, <span class="number">180</span>);</span><br><span class="line">                borderPath.lineTo(badgeWidth - badgeHeight / <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">                borderPath.addArc(<span class="keyword">new</span> RectF(badgeWidth - badgeHeight, <span class="number">0</span>, badgeWidth, badgeHeight), <span class="number">270</span>, <span class="number">180</span>);</span><br><span class="line">                borderPath.lineTo(badgeHeight / <span class="number">2</span>, badgeHeight);</span><br><span class="line">                canvas.drawPath(borderPath, contentPaint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        contentPaint.setColor(badgeBackgroundColor);</span><br><span class="line">        contentPaint.setStyle(Paint.Style.FILL);</span><br><span class="line">        <span class="keyword">if</span> (showNum) &#123;</span><br><span class="line">            <span class="comment">// 绘制红色背景图</span></span><br><span class="line">            Path path = <span class="keyword">new</span> Path();</span><br><span class="line">            path.addArc(<span class="keyword">new</span> RectF(badgeBorderWidth, badgeBorderWidth, badgeHeight - badgeBorderWidth, badgeHeight - badgeBorderWidth), <span class="number">90</span>, <span class="number">180</span>);</span><br><span class="line">            path.lineTo(badgeWidth - badgeHeight / <span class="number">2</span> + badgeBorderWidth, badgeBorderWidth);</span><br><span class="line">            path.addArc(<span class="keyword">new</span> RectF(badgeWidth - badgeHeight + badgeBorderWidth, badgeBorderWidth, badgeWidth - badgeBorderWidth, badgeHeight - badgeBorderWidth), <span class="number">270</span>, <span class="number">180</span>);</span><br><span class="line">            path.lineTo(badgeHeight / <span class="number">2</span> - badgeBorderWidth, badgeHeight - badgeBorderWidth);</span><br><span class="line">            canvas.drawPath(path, contentPaint);</span><br><span class="line">            <span class="comment">// 写上数字</span></span><br><span class="line">            canvas.drawText(showUneadText, badgeWidth / <span class="number">2</span>, badgeHeight - BADGE_TEXT_MARGIN_BOOTOM - badgeBorderWidth, badgeNumPaint);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 画实心圆</span></span><br><span class="line">            canvas.drawCircle(badgeRedSize / <span class="number">2</span> + badgeBorderWidth, badgeHeight - badgeRedSize / <span class="number">2</span> - badgeBorderWidth, badgeRedSize / <span class="number">2</span>, contentPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">intParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化主体的一些数据</span></span><br><span class="line">        <span class="keyword">if</span> (iconSrc != <span class="number">0</span>) &#123;</span><br><span class="line">            mainHeight = iconHeight;</span><br><span class="line">            mainWidth = iconWidth;</span><br><span class="line">            <span class="keyword">if</span> (iconBitmap == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Bitmap bitmap = BitmapFactory.decodeResource(getResources(), iconSrc);</span><br><span class="line">                <span class="comment">// 缩放图片</span></span><br><span class="line">                <span class="keyword">int</span> width = bitmap.getWidth();</span><br><span class="line">                <span class="keyword">int</span> height = bitmap.getHeight();</span><br><span class="line">                <span class="comment">// 保证icon的scaleType="fitCenter"</span></span><br><span class="line">                <span class="comment">// 获取图片的长边</span></span><br><span class="line">                <span class="keyword">float</span> length = width &gt; height ? width : height;</span><br><span class="line">                <span class="comment">// 获取外框的最小边</span></span><br><span class="line">                <span class="keyword">float</span> size = iconWidth &gt; iconHeight ? iconHeight : iconWidth;</span><br><span class="line">                <span class="comment">// 让图片按照长边进行缩放</span></span><br><span class="line">                <span class="keyword">float</span> scale = size / length;</span><br><span class="line">                Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">                matrix.postScale(scale, scale);</span><br><span class="line">                iconBitmap = Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, width, height, matrix, <span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 因为icon是fitCenter, 所以有真实大小</span></span><br><span class="line">            iconWidth = iconBitmap.getWidth();</span><br><span class="line">            iconHeight = iconBitmap.getHeight();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 字符描述文字的大小</span></span><br><span class="line">            Rect descRect = <span class="keyword">new</span> Rect();</span><br><span class="line">            textPaint.getTextBounds(text, <span class="number">0</span>, text.length(), descRect);</span><br><span class="line">            mainWidth = descRect.width();</span><br><span class="line">            mainHeight = descRect.height();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化Badge的数据</span></span><br><span class="line">        <span class="keyword">if</span> (showNum) &#123;</span><br><span class="line">            showUneadText = getUnreadText(badgeNum);</span><br><span class="line">            Rect badgeRect = <span class="keyword">new</span> Rect();</span><br><span class="line">            badgeNumPaint.getTextBounds(showUneadText, <span class="number">0</span>, showUneadText.length(), badgeRect);</span><br><span class="line"></span><br><span class="line">            badgeNumWidth = badgeRect.width();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (showUneadText.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 当长度为1的时候,显示正圆</span></span><br><span class="line">                badgeWidth = badgeHeight;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                badgeWidth = badgeNumWidth + BADGE_TEXT_MARGIN_LEFT + BADGE_TEXT_MARGIN_RIGHT + badgeBorderWidth * <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            badgeWidth = badgeRedSize + badgeBorderWidth * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// badgeHeight在构造方法中初始化了, 全部使用数字模式的高度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Badge位置设置的范围做一个限制</span></span><br><span class="line">        <span class="keyword">if</span> (!hasBadgeLeftAttr || badgeLeft &gt; mainWidth) &#123;</span><br><span class="line">            badgeLeft = getBadgeDefaultLocation();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!hasBadgeBottomAttr || badgeBottom &gt; mainHeight) &#123;</span><br><span class="line">            badgeBottom = getBadgeDefaultLocation();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算整体内容的大小</span></span><br><span class="line">        mainMarginHorizontal = badgeWidth - badgeLeft;</span><br><span class="line">        mainMarginTop = badgeHeight - badgeBottom;</span><br><span class="line">        viewMinWidth = mainWidth + mainMarginHorizontal * <span class="number">2</span>;</span><br><span class="line">        viewMinHeight = mainHeight + mainMarginTop;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取默认的位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">getBadgeDefaultLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 文字的时候默认往上些, 盖住文字了</span></span><br><span class="line">        <span class="keyword">return</span> iconSrc != <span class="number">0</span> ? (showNum ? badgeHeight / <span class="number">2</span> : badgeRedSize / <span class="number">2</span> + badgeBorderWidth) : badgeRedSize / <span class="number">2</span> + badgeBorderWidth - <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造未读数显示的文本</span></span><br><span class="line"><span class="comment">     * 1) 未读数默认显示形式9/23/99+</span></span><br><span class="line"><span class="comment">     * 2) 有些设计要求未读前面加"+", (至少我们设计师这么设计) 显示成 +1/+34/+99, 取配置badgeNumPre</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getUnreadText</span><span class="params">(<span class="keyword">int</span> unread)</span> </span>&#123;</span><br><span class="line">        String text = String.valueOf(unread);</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(badgeNumPre)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (unread &gt; <span class="number">99</span>) &#123;</span><br><span class="line">                text = <span class="string">"99+"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (unread &gt; <span class="number">99</span>) &#123;</span><br><span class="line">                text = badgeNumPre + <span class="string">"99"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (unread &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                text = badgeNumPre + unread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">dip2px</span><span class="params">(<span class="keyword">int</span> dpValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, dpValue, getResources().getDisplayMetrics());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">sp2px</span><span class="params">(<span class="keyword">int</span> spValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, spValue, getResources().getDisplayMetrics());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * android-自定义View解决wrap_content无效的问题</span></span><br><span class="line"><span class="comment">     * see  https://my.oschina.net/ccqy66/blog/616662</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> widthMeasureSpec</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heightMeasureSpec</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 计算高宽</span></span><br><span class="line">        intParams();</span><br><span class="line">        viewPaddingLeft = getPaddingLeft();</span><br><span class="line">        viewPaddingTop = getPaddingTop();</span><br><span class="line">        viewPaddingRight = getPaddingRight();</span><br><span class="line">        viewPaddingBootom = getPaddingBottom();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Measure Width</span></span><br><span class="line">        <span class="keyword">if</span> (widthMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            <span class="comment">// 设置的大小不能比内容还小</span></span><br><span class="line">            viewWidth = widthSize &lt; viewMinWidth ? viewMinWidth : widthSize;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            viewWidth = viewMinWidth;</span><br><span class="line">        &#125;</span><br><span class="line">        viewWidth += viewPaddingLeft + viewPaddingRight;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Measure Height</span></span><br><span class="line">        <span class="keyword">if</span> (heightMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            <span class="comment">// 设置的大小不能比内容还小</span></span><br><span class="line">            viewHeight = heightSize &lt; viewMinHeight ? viewMinHeight : heightSize;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            viewHeight = viewMinHeight;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (viewHeight &lt; viewMinHeight + VIEW_PADDING * <span class="number">2</span>) &#123;</span><br><span class="line">            viewHeight =  viewMinHeight + VIEW_PADDING * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        viewHeight += viewPaddingTop + viewPaddingBootom;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//MUST CALL THIS</span></span><br><span class="line">        setMeasuredDimension((<span class="keyword">int</span>) Math.ceil(viewWidth), (<span class="keyword">int</span>) Math.ceil(viewHeight));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;想全局统一个小红点样式，总是改了这个忘了其他的，而且小红点格式各样，总是满足不了自己的需求，所以心血来潮自己自定义View onDraw了一个。&lt;/p&gt;
&lt;p&gt;可前往查看&lt;a href=&quot;https://github.com/SkylerHu/BadgeView&quot; targ
      
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Mac修正Vim无法git提交的问题</title>
    <link href="http://yoursite.com/fix-git-commit-msg-use-vim-error/"/>
    <id>http://yoursite.com/fix-git-commit-msg-use-vim-error/</id>
    <published>2016-11-28T07:31:05.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>Git 可以使用Vim作为 Commit Message编辑器，上次不小心出现了以下错误：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: There was a problem with the editor 'vim'.Please supply the message using either -m or -F option.</span><br></pre></td></tr></table></figure></p><p>如果在 Vim 中编辑文本时因为按键失误出现类似这样：<em>E492: Not an editor command…</em> 的错误信息时，必然无法提交。</p><p>后来在 <a href="http://groups.google.com/group/vim_mac/browse_thread/thread/0d33e2f2130867b0" target="_blank" rel="noopener">Google Group: vim_mac</a> 这个帖子中找到了解决的办法，就是使用完整的 Vim 路径—— /usr/bin/vim :<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.editor /usr/bin/vim</span><br></pre></td></tr></table></figure></p><p>看了一些别的博客，说有可能的原因是：<br><code>Vim 在遇到 Exx Error 时返回 Non-Zero code 是为了兼容 Posix，不过这种情况应该只会出现在使用 Ex Mode 时，Normal/Insert Mode 是不会这样的。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Git 可以使用Vim作为 Commit Message编辑器，上次不小心出现了以下错误：&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;
      
    
    </summary>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>如何优雅的使用Vim</title>
    <link href="http://yoursite.com/vim-settings/"/>
    <id>http://yoursite.com/vim-settings/</id>
    <published>2016-09-30T07:33:13.000Z</published>
    <updated>2019-09-28T01:44:26.275Z</updated>
    
    <content type="html"><![CDATA[<h2 id="我的电脑"><a href="#我的电脑" class="headerlink" title="我的电脑"></a>我的电脑</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  sw_vers</span><br><span class="line">ProductName:    Mac OS X</span><br><span class="line">ProductVersion: 10.10.5</span><br><span class="line">BuildVersion:   14F1021</span><br><span class="line">➜  ~  python -V</span><br><span class="line">Python 2.7.10</span><br></pre></td></tr></table></figure><h2 id="配置前的准备"><a href="#配置前的准备" class="headerlink" title="配置前的准备"></a>配置前的准备</h2><p>默认大家是安装了 <a href="http://brew.sh/" target="_blank" rel="noopener">HomeBrew</a>, 没有的话请自行安装</p><p>若是需要安装Python的代码提示 <code>YouCompleteMe</code>, 要求:</p><ul><li>YouCompleteMe unavailable: requires Vim 7.3.598+</li><li>还需要Python支持Python module</li></ul><p>执行以下命令可以查看相关支持信息(<code>+</code>支持、<code>-</code>不支持)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~  vim --version</span><br><span class="line">VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Apr 28 2016 11:12:36)</span><br><span class="line">+cryptv          +linebreak       -python          +vreplace</span><br><span class="line">+cscope          +lispindent      +python3         +wildignore</span><br></pre></td></tr></table></figure><p>若是版本不对 或者 not support python module，请执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /usr/bin/vim /usr/bin/vim_bk  <span class="comment"># 把系统默认的vim备份了</span></span><br><span class="line">brew install vim --with-python3  <span class="comment"># 安装新的vim</span></span><br><span class="line"><span class="comment"># 若是下面的步骤执行不下去了，尝试一下 brew install vim --with-python</span></span><br></pre></td></tr></table></figure><ul><li>最后还需安装  <code>brew instal CMake</code></li></ul><h2 id="安装vim-插件"><a href="#安装vim-插件" class="headerlink" title="安装vim 插件"></a>安装vim 插件</h2><p>执行以下脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d ~/.vim ]; <span class="keyword">then</span></span><br><span class="line">mkdir ~/.vim</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/.vim</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d bundle ]; <span class="keyword">then</span></span><br><span class="line">mkdir bundle</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> bundle</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/VundleVim/Vundle.vim.git   <span class="comment"># 管理工具</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Lokaltog/vim-powerline.git <span class="comment"># </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/scrooloose/nerdtree.git <span class="comment"># 目录树</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/jistr/vim-nerdtree-tabs.git  <span class="comment"># </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/vim-scripts/taglist.vim.git <span class="comment"># 方法类跳转</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/vim-scripts/AutoTag.git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/scrooloose/syntastic.git  <span class="comment"># js语法检测</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/tpope/vim-fugitive.git <span class="comment"># 显示Git信息</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Valloric/YouCompleteMe.git <span class="comment"># python 自动补全</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/hynek/vim-python-pep8-indent <span class="comment"># pep8 python语法 需要在项目虚拟环境下 pip install pep8</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/nvie/vim-flake8 <span class="comment"># 代码风格检测 需要在项目虚拟环境下 pip install flake8</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Yggdroot/indentLine  <span class="comment"># 代码格式对齐线</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com:scrooloose/nerdcommenter.git  <span class="comment"># 快捷注释</span></span><br><span class="line"><span class="comment"># git clone https://github.com/vim-ruby/vim-ruby # ruby插件</span></span><br><span class="line"><span class="built_in">cd</span> YouCompleteMe</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line">./install.py  --clang-completer</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">mkdir -p ~/.vim/<span class="built_in">autoload</span> ~/.vim/bundle &amp;&amp; curl -LSso ~/.vim/<span class="built_in">autoload</span>/pathogen.vim https://tpo.pe/pathogen.vim</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">brew install ctags</span><br></pre></td></tr></table></figure><p>以上所有vim插件都在GitHub上<br>若是要更新哪个插件，直接到插件目录下去git pull 就行了；<br>值得注意的是 最好查看下插件的README，看它的用发是否发生了改变，需要自行更新 .vimrc中的配置</p><h2 id="vimrc-配置文件"><a href="#vimrc-配置文件" class="headerlink" title=".vimrc 配置文件"></a>.vimrc 配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">vim .vimrc  <span class="comment"># 编辑 .vimrc 文件 内容如下</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">syntax on</span><br><span class="line">set encoding=utf-8</span><br><span class="line">&quot; 自动缩进</span><br><span class="line">set autoindent</span><br><span class="line">set cindent</span><br><span class="line">set autoread &quot; 设置当文件被改动时自动载入</span><br><span class="line">set wildmenu &quot; 增强模式中的命令行自动完成操作</span><br><span class="line">set showcmd         &quot; 输入的命令显示出来，看的清楚些  </span><br><span class="line">set whichwrap+=&lt;,&gt;,h,l  &quot; 允许backspace和光标键跨越行边界</span><br><span class="line">set ruler           &quot; 显示标尺  </span><br><span class="line">set tabstop=4</span><br><span class="line">set shiftwidth=4</span><br><span class="line">set softtabstop=4</span><br><span class="line">&quot;为不同的文件类型设置不同的空格数替换TAB</span><br><span class="line">autocmd FileType php,python,c,java,perl,shell,bash,vim,ruby,cpp set ai</span><br><span class="line">autocmd FileType php,python,c,java,perl,shell,bash,vim,ruby,cpp set sw=4</span><br><span class="line">autocmd FileType php,python,c,java,perl,shell,bash,vim,ruby,cpp set ts=4</span><br><span class="line">autocmd FileType php,python,c,java,perl,shell,bash,vim,ruby,cpp set sts=4</span><br><span class="line">autocmd FileType javascript,html,css,xml set ai</span><br><span class="line">autocmd FileType javascript,html,css,xml set sw=2</span><br><span class="line">autocmd FileType javascript,html,css,xml set ts=2</span><br><span class="line">autocmd FileType javascript,html,css,xml set sts=2</span><br><span class="line">set expandtab</span><br><span class="line">set nu</span><br><span class="line">set hlsearch</span><br><span class="line">set incsearch</span><br><span class="line">set colorcolumn=120</span><br><span class="line">set cul &quot;高亮光标所在行</span><br><span class="line">autocmd InsertEnter * se cul    &quot; 用浅色高亮当前行  </span><br><span class="line">set scrolloff=3     &quot; 光标移动到buffer的顶部和底部时保持3行距离  </span><br><span class="line">&quot;set statusline=%&lt;\ %n:%F\ %m%r%y%=%-35.(line:\ %l\ of\ %L,\ col:\ %c%V\ (%P)%)</span><br><span class="line">set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %&#123;strftime(\&quot;%d/%m/%y\ -\ %H:%M\&quot;)&#125;   &quot;状态行显示的内容  </span><br><span class="line">set laststatus=2</span><br><span class="line">set ignorecase</span><br><span class="line">set backspace=indent,eol,start &quot; backspace over everything in insert mode</span><br><span class="line">set nocompatible              &quot; be iMproved, required</span><br><span class="line">filetype off                  &quot; required</span><br><span class="line"></span><br><span class="line">set foldnestmax=10      &quot;deepest fold is 10 levels</span><br><span class="line">set foldlevel=1         &quot;this is just what i use</span><br><span class="line">set foldmethod=marker</span><br><span class="line"></span><br><span class="line">set paste</span><br><span class="line"></span><br><span class="line">map &lt;F2&gt; :mksession! ~/.vim_session &lt;cr&gt; &quot; Quick write session with F2</span><br><span class="line">map &lt;F3&gt; :source ~/.vim_session &lt;cr&gt;     &quot; And load session with F3</span><br><span class="line"></span><br><span class="line">execute pathogen#infect()</span><br><span class="line"></span><br><span class="line">function! ResCur()</span><br><span class="line">        if line(&quot;&apos;\&quot;&quot;) &lt;= line(&quot;$&quot;)</span><br><span class="line">                normal! g`&quot;</span><br><span class="line">                return 1</span><br><span class="line">        endif</span><br><span class="line">endfunction</span><br><span class="line"></span><br><span class="line">augroup resCur</span><br><span class="line">        autocmd!</span><br><span class="line">        autocmd BufWinEnter * call ResCur()</span><br><span class="line">augroup END</span><br><span class="line"></span><br><span class="line">filetype plugin indent on    &quot; required</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;新文件标题</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;新建.c,.h,.sh,.java文件，自动插入文件头 </span><br><span class="line">autocmd BufNewFile *.cpp,*.[ch],*.sh,*.rb,*.java,*.py exec &quot;:call SetTitle()&quot; </span><br><span class="line">&quot;&quot;定义函数SetTitle，自动插入文件头 </span><br><span class="line">func SetTitle() </span><br><span class="line">&quot;如果文件类型为.sh文件 </span><br><span class="line">if &amp;filetype == &apos;sh&apos; </span><br><span class="line">call setline(1,&quot;\#!/bin/bash&quot;) </span><br><span class="line">call append(line(&quot;.&quot;), &quot;&quot;) </span><br><span class="line">    elseif &amp;filetype == &apos;python&apos;</span><br><span class="line">        call setline(1,&quot;#!/usr/bin/env python&quot;)</span><br><span class="line">        call append(line(&quot;.&quot;),&quot;# coding=utf-8&quot;)</span><br><span class="line">    call append(line(&quot;.&quot;)+1, &quot;&quot;) </span><br><span class="line">endif</span><br><span class="line">endfunc </span><br><span class="line">autocmd BufNewFile * normal G</span><br><span class="line"></span><br><span class="line">au BufNewFile,BufRead *.yml set filetype=xml</span><br><span class="line">autocmd FileType python setlocal completeopt-=preview</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;&quot;&quot;&quot; 插件管理</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot; set the runtime path to include Vundle and initialize</span><br><span class="line">set rtp+=~/.vim/Vundle.vim</span><br><span class="line">call vundle#begin()</span><br><span class="line">&quot; alternatively, pass a path where Vundle should install plugins</span><br><span class="line">&quot;call vundle#begin(&apos;~/some/path/here&apos;)</span><br><span class="line"></span><br><span class="line">&quot; let Vundle manage Vundle, required</span><br><span class="line">Plugin &apos;gmarik/Vundle.vim&apos;</span><br><span class="line">&quot; All of your Plugins must be added before the following line</span><br><span class="line">call vundle#end()            &quot; required</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;Yggdroot/indentLine</span><br><span class="line">let g:indentLine_char = &apos;┊&apos;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;powerline&#123;</span><br><span class="line">set guifont=PowerlineSymbols\ for\ Powerline</span><br><span class="line">set nocompatible</span><br><span class="line">set t_Co=256</span><br><span class="line">let g:Powerline_stl_path_style = &quot;full&quot;</span><br><span class="line">&quot;&#125;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;打开文件类型检测, 加了这句才可以用智能补全</span><br><span class="line">set completeopt=preview,menu </span><br><span class="line">set completeopt=longest,menu</span><br><span class="line">&quot;python补全</span><br><span class="line">let g:pydiction_location = &apos;~/.vim/after/complete-dict&apos;</span><br><span class="line">let g:pydiction_menu_height = 20</span><br><span class="line">let g:miniBufExplMapWindowNavVim = 1</span><br><span class="line">let g:miniBufExplMapWindowNavArrows = 1</span><br><span class="line">let g:miniBufExplMapCTabSwitchBufs = 1</span><br><span class="line">let g:miniBufExplModSelTarget = 1</span><br><span class="line">&quot; ycm 此处要设置成python版本2.7，不要设置成python3了</span><br><span class="line">let g:ycm_path_to_python_interpreter=&quot;python&quot;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;syntax check</span><br><span class="line">set statusline+=%#warningmsg#</span><br><span class="line">set statusline+=%&#123;SyntasticStatuslineFlag()&#125;</span><br><span class="line">set statusline+=%*</span><br><span class="line">let g:syntastic_always_populate_loc_list = 1</span><br><span class="line">let g:syntastic_check_on_open = 1</span><br><span class="line">let g:syntastic_check_on_wq = 0</span><br><span class="line">let g:syntastic_auto_loc_list = 1</span><br><span class="line">let g:syntastic_python_checkers=[&apos;flake8&apos;]</span><br><span class="line">let g:syntastic_python_flake8_args=&apos;--ignore W391,E501 --max-line-length 119&apos;</span><br><span class="line">let g:syntastic_loc_list_height=3</span><br><span class="line">let g:syntastic_enable_highlighting=0</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;ctags</span><br><span class="line">set tags=./tags,tags;</span><br><span class="line">&quot; Tag list (ctags) </span><br><span class="line">let Tlist_Ctags_Cmd = &apos;/usr/local/bin/ctags&apos; </span><br><span class="line">let Tlist_Show_One_File = 1 &quot;不同时显示多个文件的tag，只显示当前文件的 </span><br><span class="line">let Tlist_File_Fold_Auto_Close = 1</span><br><span class="line">let Tlist_Exit_OnlyWindow = 1 &quot;如果taglist窗口是最后一个窗口，则退出vim </span><br><span class="line">let Tlist_Use_Right_Window = 1 &quot;在右侧窗口中显示taglist窗口</span><br><span class="line">nmap tl :Tlist&lt;cr&gt;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;so that when you preview the new file takes up 80% and the file explorer the other 20%.</span><br><span class="line">let g:netrw_winsize=25</span><br><span class="line">let g:netrw_altv = 2</span><br><span class="line">let g:netrw_browse_split = 3</span><br><span class="line">let g:netrw_keepdir = 0</span><br><span class="line">let NERDTreeWinSize=30</span><br><span class="line">&quot;let g:nerdtree_tabs_open_on_console_startup=1</span><br><span class="line">&quot;列出当前目录文件  </span><br><span class="line">map &lt;F3&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">imap &lt;F3&gt; &lt;ESC&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">&quot;当打开vim且没有文件时自动打开NERDTree</span><br><span class="line">autocmd vimenter * if !argc() | NERDTree | endif</span><br><span class="line">&quot; 只剩 NERDTree时自动关闭</span><br><span class="line">autocmd bufenter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTreeType&quot;) &amp;&amp; b:NERDTreeType == &quot;primary&quot;) | q | endif</span><br><span class="line">&quot; 忽略的文件不加载</span><br><span class="line">set wildignore+=**/fe-dist/**</span><br><span class="line">set wildignore+=**/node_modules/**</span><br><span class="line">set wildignore+=**/log/**</span><br><span class="line">set wildignore+=**/static/**</span><br><span class="line">set wildignore+=*.swp,*.zip,*.pyc,.git/</span><br><span class="line">set path=.,,**</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot;Yggdroot/indentLine</span><br><span class="line">let g:indentLine_char = &apos;┊&apos;</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">&quot; 注释的时候自动加个空格, 强迫症必配</span><br><span class="line">&quot; let g:NERDSpaceDelims=1</span><br><span class="line">let mapleader=&quot;,&quot;</span><br></pre></td></tr></table></figure><h2 id="用-vundle-管理-vim-插件"><a href="#用-vundle-管理-vim-插件" class="headerlink" title="用 vundle 管理 vim 插件"></a>用 vundle 管理 vim 插件</h2><p>其实上面脚本一键执行也挺方便的，此处只是稍微介绍一下 vundle 的用法。</p><p>可在 <code>.vimrc</code>  文件中添加配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Bundle &apos;cespare/vim-golang&apos;</span><br><span class="line">Bundle &apos;taglist.vim&apos;</span><br><span class="line">Bundle &apos;dhruvasagar/vim-table-mode&apos;</span><br><span class="line">Bundle &apos;godlygeek/tabular&apos;</span><br><span class="line">Bundle &apos;derekwyatt/vim-scala&apos;</span><br><span class="line">Bundle &apos;kien/ctrlp.vim&apos;</span><br><span class="line">Bundle &apos;Valloric/YouCompleteMe&apos;</span><br><span class="line">Bundle &apos;Yggdroot/indentLine&apos;</span><br></pre></td></tr></table></figure><p>随便开个窗口，从控制台打开vim，然后执行-&gt; :BundleInstall ，vundle会自动下载声明的插件并安装到 ./vim/bundle 目录里面</p><p><strong> 到此，安装结束，可以畅游vim了。 </strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;我的电脑&quot;&gt;&lt;a href=&quot;#我的电脑&quot; class=&quot;headerlink&quot; title=&quot;我的电脑&quot;&gt;&lt;/a&gt;我的电脑&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre
      
    
    </summary>
    
    
      <category term="vim" scheme="http://yoursite.com/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu 解决语言设置错误的问题</title>
    <link href="http://yoursite.com/ubuntu-set-language/"/>
    <id>http://yoursite.com/ubuntu-set-language/</id>
    <published>2016-06-28T03:26:05.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>在使用 ubuntu 命令行登录的时候，出现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">perl: warning: Setting locale failed.</span><br><span class="line">perl: warning: Please check that your locale settings:</span><br><span class="line">    LANGUAGE = (unset),</span><br><span class="line">    LC_ALL = (unset),</span><br><span class="line">    LC_MESSAGES = &quot;zh_CN.UTF-8&quot;,</span><br><span class="line">    LANG = &quot;zh_CN.UTF-8&quot;</span><br><span class="line">    are supported and installed on your system.</span><br><span class="line">perl: warning: Falling back to the standard locale (&quot;C&quot;).</span><br></pre></td></tr></table></figure><p>这样的错误，虽说不影响使用，但是感觉挺烦的说。</p><p>那么要如何解决呢，有必要记录下：</p><p>安装 <code>localepurge</code> 管理语言文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install localepurge</span><br></pre></td></tr></table></figure><p>选择我们想要的语言，例如 <code>en_US.UTF-8</code> 和 <code>zh_CN.UTF-8</code>。</p><p>当然也可以使用以下命令再次进行配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure localepurge</span><br></pre></td></tr></table></figure><p>生成自己想要的语言</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo locale-gen zh_CN.UTF-8 en_US.UTF-8</span><br></pre></td></tr></table></figure><p>打印出当前的配置信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locale</span><br></pre></td></tr></table></figure><p>到此，搞定！！！</p><p>默认情况下终端 ssh 的时候会将本地的 locale 传到服务器中，可以通过命令指定 ssh 服务器的语言：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LC_ALL=en_US.UTF-8 ssh &lt;host&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在使用 ubuntu 命令行登录的时候，出现：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>hexo/Jekyll + github搭建自己的博客</title>
    <link href="http://yoursite.com/hexo-Jekyll-github/"/>
    <id>http://yoursite.com/hexo-Jekyll-github/</id>
    <published>2016-06-27T07:41:41.000Z</published>
    <updated>2019-09-28T01:53:34.562Z</updated>
    
    <content type="html"><![CDATA[<p>首先，必须有一个GitHub账号，相信大家都有，没有的话自己去创建吧。</p><h3 id="一、GitHub-Pages的使用"><a href="#一、GitHub-Pages的使用" class="headerlink" title="一、GitHub Pages的使用"></a>一、GitHub Pages的使用</h3><h4 id="1-创建一个分支，使用你的GitHub-name"><a href="#1-创建一个分支，使用你的GitHub-name" class="headerlink" title="1. 创建一个分支，使用你的GitHub name"></a>1. 创建一个分支，使用你的GitHub name</h4><p>Head over to GitHub and create a new repository named username.github.io, where username is your username (or organization name) on GitHub.</p><p>我的GitHub name是 SkylerHu，以我的名字为例。</p><h4 id="2-初始化项目"><a href="#2-初始化项目" class="headerlink" title="2. 初始化项目"></a>2. 初始化项目</h4><p><strong>若是借助Jekyll和hexo的话，只需clone下来即可。</strong></p><blockquote><p>已下步骤是基于terminal的git命令，若是使用界面工具，自己去<a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>看</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/SkylerHu/SkylerHu.github.io</span><br><span class="line">~$ <span class="built_in">cd</span> SkylerHu.github.io</span><br><span class="line">~$ <span class="built_in">echo</span> <span class="string">"Hello World"</span> &gt; index.html</span><br><span class="line">~$ git add --all</span><br><span class="line">~$ git commit -m <span class="string">"Initial commit"</span></span><br><span class="line">~$ git push -u origin master</span><br></pre></td></tr></table></figure><p>也可以在index.html中添加HTML内容，然后在push</p><p>一切OK之后，可以访问 <a href="http://SkylerHu.github.io" target="_blank" rel="noopener">http://SkylerHu.github.io</a>.  可以查看index.html的内容。这个网址就是你的博客网址。</p><h3 id="二、使用Jekyll"><a href="#二、使用Jekyll" class="headerlink" title="二、使用Jekyll"></a>二、使用Jekyll</h3><p>上面新建的项目中，Settings中可以看到GitHubPages相关配置，官方推荐使用<a href="http://jekyll.bootcss.com/" target="_blank" rel="noopener">Jekyll</a><br><img src="http://blog-img.skylerhu.com/2016/06/27/81479b8884.png" alt="GitHub Pages Settings"></p><h4 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1. 初始化"></a>1. 初始化</h4><p>安装需要Ruby环境，没有的话自行安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ gem install jekyll</span><br><span class="line">~$ jekyll new my-awesome-site</span><br></pre></td></tr></table></figure><p>把项目生成的所有文件，全部copy到<code>SkylerHu.github.io</code>目录下.</p><h4 id="2-目录结构"><a href="#2-目录结构" class="headerlink" title="2. 目录结构"></a>2. 目录结构</h4><ul><li><a href="http://jekyll.bootcss.com/docs/structure/" target="_blank" rel="noopener">目录结构</a></li></ul><h4 id="3-本地启动预览"><a href="#3-本地启动预览" class="headerlink" title="3. 本地启动预览"></a>3. 本地启动预览</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> SkylerHu.github.io</span><br><span class="line">~/SkylerHu.github.io$ jekyll serve</span><br></pre></td></tr></table></figure><p>直接访问<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a>  就可以看到你的网站了。</p><h4 id="4-写文章"><a href="#4-写文章" class="headerlink" title="4. 写文章"></a>4. 写文章</h4><p>在目录<code>/SkylerHu.github.io/_posts/</code>下新建xxxx.md；<br>格式需要按照模板提供的去写； </p><h4 id="5-部署"><a href="#5-部署" class="headerlink" title="5. 部署"></a>5. 部署</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/SkylerHu.github.io$ git add --all</span><br><span class="line">~/SkylerHu.github.io$ git push</span><br></pre></td></tr></table></figure><h4 id="6-使用自己的域名"><a href="#6-使用自己的域名" class="headerlink" title="6. 使用自己的域名"></a>6. 使用自己的域名</h4><h5 id="1-添加CNAME文件push到GitHub"><a href="#1-添加CNAME文件push到GitHub" class="headerlink" title="1) 添加CNAME文件push到GitHub"></a>1) 添加CNAME文件push到GitHub</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/SkylerHu.github.io$ <span class="built_in">echo</span> <span class="string">"pages.skylerhu.com"</span> &gt; CNAME</span><br></pre></td></tr></table></figure><h5 id="2-域名解析"><a href="#2-域名解析" class="headerlink" title="2) 域名解析"></a>2) 域名解析</h5><p>使pages.skylerhu.com解析到 SkylerHu.github.io<br>注意选择 解析类型是<code>CNAME</code></p><h4 id="7-主题"><a href="#7-主题" class="headerlink" title="7. 主题"></a>7. 主题</h4><p>推荐网站：</p><ul><li><a href="http://jekyllthemes.org/" target="_blank" rel="noopener">http://jekyllthemes.org/</a></li><li><a href="https://jekyllthemes.io/" target="_blank" rel="noopener">https://jekyllthemes.io/</a></li></ul><p>可以根据自己的喜好去选择主题，都大同小异。</p><h3 id="三、使用hexo"><a href="#三、使用hexo" class="headerlink" title="三、使用hexo"></a>三、使用hexo</h3><p>之所有使用<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">hexo</a>,因为好多网友都说这个比较好，所有研究了一下使用方法。</p><p>需要安装<a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a></p><h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo npm install -g hexo</span><br></pre></td></tr></table></figure><h4 id="2-初始化"><a href="#2-初始化" class="headerlink" title="2. 初始化"></a>2. 初始化</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> blog</span><br><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">~/blog$ hexo init</span><br><span class="line"><span class="comment"># 生成静态页面，把markdown转化成html，hexo g 也行</span></span><br><span class="line">~/blog$ hexo generate</span><br><span class="line"><span class="comment"># 启动本地服务，hexo s 也行</span></span><br><span class="line">~/blog$ hexo server</span><br></pre></td></tr></table></figure><p>其他<a href="https://hexo.io/zh-cn/docs/commands.html" target="_blank" rel="noopener">hexo命令</a></p><p>若是之后nodejs升级了，需要执行一下 <code>npm --registry=https://registry.npm.taobao.org install</code><br>或者直接执行 <code>npm install</code>, 有参数的意思是使用淘宝源</p><h4 id="3-配置GitHub"><a href="#3-配置GitHub" class="headerlink" title="3. 配置GitHub"></a>3. 配置GitHub</h4><p>编辑blog目录下_config.yml文件，详见<a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">hexo配置</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/blog$ vim _config.yml</span><br></pre></td></tr></table></figure><p>找到<code>deploy</code>配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">     type: git</span><br><span class="line">     repo:https://github.com/SkylerHu/SkylerHu.github.io.git</span><br><span class="line">     branch:master</span><br><span class="line">     message: commit的message，默认 Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;</span><br></pre></td></tr></table></figure></p><p>保存后执行命令安装插件<a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="noopener">hexo-deployer-git</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/blog$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p><h4 id="4-配置RSS"><a href="#4-配置RSS" class="headerlink" title="4. 配置RSS"></a>4. 配置RSS</h4><p>编辑_config.yml配置feed<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feed:</span><br><span class="line">  type: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  limit: 20</span><br><span class="line">  hub:</span><br></pre></td></tr></table></figure></p><p>安装插件<a href="https://github.com/hexojs/hexo-generator-feed" target="_blank" rel="noopener">hexo-generator-feed</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/blog$ npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure><h4 id="5-部署GitHub-Pages"><a href="#5-部署GitHub-Pages" class="headerlink" title="5. 部署GitHub Pages"></a>5. 部署GitHub Pages</h4><p>部署之前可以修改_confi.yml中deploy.message作为git commit的message<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每次修改之后都需要clean和generate</span></span><br><span class="line">~/blog$ hexo clean</span><br><span class="line">~/blog$ hexo generate</span><br><span class="line"><span class="comment"># hexo d 也可以</span></span><br><span class="line">~/blog$ hexo deploy</span><br></pre></td></tr></table></figure></p><p>会生成一个<code>.deploy_git</code> 文件夹同步到GitHub项目中。</p><h4 id="5-主题"><a href="#5-主题" class="headerlink" title="5. 主题"></a>5. 主题</h4><p>推荐网站<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a><br>我自己使用的是 <a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">hexo-theme-yilia</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/litten/hexo-theme-yilia.git themes/yilia</span><br></pre></td></tr></table></figure><p>修改hexo根目录下的 _config.yml ： theme: yilia</p><h4 id="6-使用自己的域名-1"><a href="#6-使用自己的域名-1" class="headerlink" title="6. 使用自己的域名"></a>6. 使用自己的域名</h4><p>同Jekyll一样，也需要修改域名解析，同样也要在GitHub项目下添加CNAME文件。</p><blockquote><p>注意：</p><ul><li>不能直接在<code>deploy_git</code>目录下直接添加CNAME文件，每次generate之后会删除</li><li>需要添加到<code>source</code>文件夹下<code>echo &quot;pages.skylerhu.com&quot; &gt; source/CNAME</code></li></ul></blockquote><h4 id="7-其他配置"><a href="#7-其他配置" class="headerlink" title="7. 其他配置"></a>7. 其他配置</h4><p>可以在blog/_config.yml配置<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener">语言和时区</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">language: zh-Hans</span><br><span class="line">timezone: Asia/Shanghai</span><br></pre></td></tr></table></figure></p><p>我的网站还添加了<code>多说评论</code>和<code>百度统计</code>，具体使用详见<a href="http://ijiaober.github.io/categories/hexo/" target="_blank" rel="noopener">推荐网站</a>。</p><h3 id="四、比较"><a href="#四、比较" class="headerlink" title="四、比较"></a>四、比较</h3><table><thead><tr><th></th><th>Jekyll</th><th>hexo</th></tr></thead><tbody><tr><td>语言</td><td>Ruby</td><td>node.js</td></tr><tr><td>效率</td><td>So fast</td><td>稍慢</td></tr><tr><td>部署</td><td>需要多个命令</td><td>直接使用git命令</td></tr></tbody></table><blockquote><p>两个之间都可以互相迁移，看个人操作习惯和爱好吧。</p></blockquote><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>升级了Node.js后，发现在项目目录中执行hexo相关命令会报出错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Error: Module version mismatch. Expected 47, got 46.]</span><br><span class="line">&#123; [Error: Cannot find module &apos;./build/default/DTraceProviderBindings&apos;] code: &apos;MODULE_NOT_FOUND&apos; &#125;</span><br><span class="line">&#123; [Error: Cannot find module &apos;./build/Debug/DTraceProviderBindings&apos;] code: &apos;MODULE_NOT_FOUND&apos; &#125;</span><br></pre></td></tr></table></figure><p>解决方案如下：</p><ul><li>执行npm uninstall hexo卸载hexo；</li><li>重新安装hexo，npm install -g hexo；</li><li>到博客目录执行npm install，hexo clean，hexo generate</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;首先，必须有一个GitHub账号，相信大家都有，没有的话自己去创建吧。&lt;/p&gt;
&lt;h3 id=&quot;一、GitHub-Pages的使用&quot;&gt;&lt;a href=&quot;#一、GitHub-Pages的使用&quot; class=&quot;headerlink&quot; title=&quot;一、GitHub Pages的
      
    
    </summary>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="Jekyll" scheme="http://yoursite.com/tags/Jekyll/"/>
    
      <category term="GitHub" scheme="http://yoursite.com/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>owncloud在mac finder中没有显示状态icon</title>
    <link href="http://yoursite.com/ownclound-disable-fileicon-on-mac/"/>
    <id>http://yoursite.com/ownclound-disable-fileicon-on-mac/</id>
    <published>2016-06-26T10:58:51.000Z</published>
    <updated>2019-09-28T01:53:33.767Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>owncloud客户端在mac上使用，没有显示status icon(文件或者文件夹的同步状态图标)</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><h4 id="1-打开设置"><a href="#1-打开设置" class="headerlink" title="1. 打开设置"></a>1. 打开设置</h4><p><img src="http://blog-img.skylerhu.com/2016/05/10/91c7781082.png" alt="Pic 01"></p><h4 id="2-把勾给选中"><a href="#2-把勾给选中" class="headerlink" title="2. 把勾给选中"></a>2. 把勾给选中</h4><p><img src="http://blog-img.skylerhu.com/2016/05/10/8003ac235a.png" alt="Pic 02"></p><h4 id="3-结果"><a href="#3-结果" class="headerlink" title="3. 结果"></a>3. 结果</h4><p><img src="http://blog-img.skylerhu.com/2016/05/10/e4a26526ea.png" alt="Pic 03"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h3&gt;&lt;p&gt;owncloud客户端在mac上使用，没有显示status icon(文件或者文件夹的同步状态图标)&lt;/p&gt;
&lt;h3 id=&quot;解决&quot;&gt;&lt;a 
      
    
    </summary>
    
    
      <category term="owncloud" scheme="http://yoursite.com/tags/owncloud/"/>
    
  </entry>
  
  <entry>
    <title>Shadowsocks+SwitchySharp</title>
    <link href="http://yoursite.com/Shadowsocks-SwitchySharp/"/>
    <id>http://yoursite.com/Shadowsocks-SwitchySharp/</id>
    <published>2016-06-26T10:56:08.000Z</published>
    <updated>2019-09-28T01:44:26.273Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>若要申请VPS可使用这个<a href="http://www.digitalocean.com/?refcode=a80753a9aac2" target="_blank" rel="noopener">DigtalOcean</a>，会赠送你$10用于购买VPS。</p></blockquote><p>ShadowSocks<a href="http://shadowsocks.org/en/download/servers.html" target="_blank" rel="noopener">官网</a></p><h4 id="1-gcc安装"><a href="#1-gcc安装" class="headerlink" title="1. gcc安装"></a>1. gcc安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-toolchain-r/<span class="built_in">test</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gcc-4.8</span><br></pre></td></tr></table></figure><h4 id="2-go-环境搭建"><a href="#2-go-环境搭建" class="headerlink" title="2. go 环境搭建"></a>2. go 环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/golang/go1.4.linux-386.tar.gz</span><br><span class="line">sudo tar -C /usr/src -xzf go1.4.linux-386.tar.gz</span><br></pre></td></tr></table></figure><p>在 $HOME/.bashrc 文件末添加如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOROOT=/usr/src/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin</span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go</span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOROOT</span>/src</span><br><span class="line">sudo ./all.bash       （若是缺少，apt-get install gccgo-go）</span><br></pre></td></tr></table></figure><h4 id="3-安装git"><a href="#3-安装git" class="headerlink" title="3. 安装git"></a>3. 安装git</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git-core</span><br></pre></td></tr></table></figure><h4 id="4-安装"><a href="#4-安装" class="headerlink" title="4. 安装"></a>4. 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/shadowsocks/shadowsocks-go/cmd/shadowsocks-server</span><br><span class="line">shadowsocks-go</span><br></pre></td></tr></table></figure><h4 id="5-配置"><a href="#5-配置" class="headerlink" title="5. 配置"></a>5. 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/</span><br><span class="line">sudo mkdir shadowsocks</span><br><span class="line"><span class="built_in">cd</span> shadowsocks</span><br><span class="line">sudo touch config.json</span><br></pre></td></tr></table></figure><h4 id="6-写入"><a href="#6-写入" class="headerlink" title="6. 写入"></a>6. 写入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"server"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">  <span class="string">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="string">"local_port"</span>: 1080,</span><br><span class="line">  <span class="string">"timeout"</span>: 300,</span><br><span class="line">  <span class="string">"method"</span>: <span class="string">"aes-256-cfb"</span>,</span><br><span class="line">  <span class="string">"fast_open"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"port_password"</span>: &#123;</span><br><span class="line">    <span class="string">"12345"</span>: <span class="string">"xxx1"</span>,</span><br><span class="line">    <span class="string">"12346"</span>: <span class="string">"xxx2"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-启动关闭"><a href="#7-启动关闭" class="headerlink" title="7. 启动关闭"></a>7. 启动关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">vim .profile</span><br><span class="line">添加</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PATH</span>:/root/go/bin"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> .profile</span><br><span class="line">shadowsocks-server -c /etc/shadowsocks/config.json -d start</span><br><span class="line">shadowsocks-server -c /etc/shadowsocks/config.json -d stop</span><br><span class="line"></span><br><span class="line">nohup shadowsocks-server -c /etc/shadowsocks/config.json</span><br></pre></td></tr></table></figure><h4 id="8-开机启动"><a href="#8-开机启动" class="headerlink" title="8. 开机启动"></a>8. 开机启动</h4><p>编辑 /etc/rc.local,在exit 0之前</p><p><code>/root/go/bin/shadowsocks-server -c /etc/shadowsocks/config.json start</code></p><h4 id="9-配置SwitchySharp"><a href="#9-配置SwitchySharp" class="headerlink" title="9. 配置SwitchySharp"></a>9. 配置SwitchySharp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(fbcdn|akamaihd|pixnet)\.net|wretch\.cc|t\.co|goo\.gl|(google(usercontent|apis)*|chrome|staticflickr|imdb|ytimg|gstatic|html5rocks|amazonaws|github|tumblr|addthis|wordpress|blogger|(blog|app)spot|friendfeed|twitter|facebook|youtube|dropbox|feedburner|googleapis|android)\.com</span><br></pre></td></tr></table></figure><p><a href="http://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt" target="_blank" rel="noopener">http://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt</a> (这个连接404访问不了， 可用下面链接)<br><a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt" target="_blank" rel="noopener">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;若要申请VPS可使用这个&lt;a href=&quot;http://www.digitalocean.com/?refcode=a80753a9aac2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DigtalOcean&lt;/a&gt;，会赠送你$
      
    
    </summary>
    
    
      <category term="Shadowsocks" scheme="http://yoursite.com/tags/Shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu搭建VPN</title>
    <link href="http://yoursite.com/Ubuntu-VPN/"/>
    <id>http://yoursite.com/Ubuntu-VPN/</id>
    <published>2016-06-26T10:46:54.000Z</published>
    <updated>2019-09-28T01:44:26.274Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>若要申请VPS可使用这个<a href="http://www.digitalocean.com/?refcode=a80753a9aac2" target="_blank" rel="noopener">DigtalOcean</a>，会赠送你$10用于购买VPS。</p></blockquote><p>采用PPTP搭建VPN，优点是配置简单快捷。将亲身过程记录下来供亲们参考，并将过程中遇到的问题也一一列举出来解决方式。。。</p><p>直接上步骤:</p><h4 id="1-第一步需要安装PPTP，以用来提供VPN服务"><a href="#1-第一步需要安装PPTP，以用来提供VPN服务" class="headerlink" title="1.第一步需要安装PPTP，以用来提供VPN服务."></a>1.第一步需要安装PPTP，以用来提供VPN服务.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install pptpd</span><br></pre></td></tr></table></figure><p>如果有问题的话比如提示找不到之类的，apt-get update 一下应该就可以了，然后再来一次就会自动完成安装。</p><h4 id="2-装好了之后我们需要进行配置一下以让它可以使用"><a href="#2-装好了之后我们需要进行配置一下以让它可以使用" class="headerlink" title="2.装好了之后我们需要进行配置一下以让它可以使用."></a>2.装好了之后我们需要进行配置一下以让它可以使用.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/pptpd.conf</span><br></pre></td></tr></table></figure><p>取消掉以下 2 行的注释：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localip 192.168.0.1</span><br><span class="line">remoteip 192.168.0.234-238,192.168.0.245</span><br></pre></td></tr></table></figure><p>分别是通过VPN连接后主机和客户端所使用的IP，可以自行修改。注意这个IP在下面还会用的到。</p><h4 id="3-然后我们需要分配账号给自己使用"><a href="#3-然后我们需要分配账号给自己使用" class="headerlink" title="3.然后我们需要分配账号给自己使用."></a>3.然后我们需要分配账号给自己使用.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ppp/chap-secrets</span><br></pre></td></tr></table></figure><p>这个是用户列表文件</p><p>在里面添加账户按如下格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username  pptpd  <span class="string">"password"</span>  *</span><br></pre></td></tr></table></figure><p><code>username</code>为你的用户名<code>password</code>为你的密码，密码用引号引起,最后的<code>*</code>号表示允许在任意IP连接到服务</p><h4 id="4-至此服务弄好了"><a href="#4-至此服务弄好了" class="headerlink" title="4.至此服务弄好了"></a>4.至此服务弄好了</h4><p>如果你sudo service pptpd restart一下，就应该已经能连接到该VPN了，但是连接了之后会发现还访问不了外网。然后我们需要让他能访问外网。首先，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ppp/pptpd-options</span><br></pre></td></tr></table></figure><p>找到ms-dns，取消掉注释，改成你喜欢的DNS比如8.8.8.8, 8.8.4.4</p><h4 id="5-然后我们要开启内核IP转发"><a href="#5-然后我们要开启内核IP转发" class="headerlink" title="5.然后我们要开启内核IP转发"></a>5.然后我们要开启内核IP转发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>取消掉 <code>net.ipv4.ip_forward=1</code> 这一行的注释.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h4 id="6-然后我们需要安装iptables，用来实现请求的NAT转发"><a href="#6-然后我们需要安装iptables，用来实现请求的NAT转发" class="headerlink" title="6.然后我们需要安装iptables，用来实现请求的NAT转发"></a>6.然后我们需要安装iptables，用来实现请求的NAT转发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install iptables</span><br></pre></td></tr></table></figure><p>然后开启NAT转发.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>192.168.0.0/24是你在上面设置的IP段，让这个段转发</p><p>注意eth0是你连接外网的那块网卡，不一定是0也有可能是1或者看你的机器哪块网卡连的外网了。这样就以NAT的方式请求外网的东西了。不知道你的机器哪块网卡连的外网的话ifconfig一下看看哪个网卡是外网IP就知道了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 192.168.217.0/24 -o eth0 -j MASQUERADE</span><br><span class="line">iptables-save &gt; /etc/iptables.pptp</span><br></pre></td></tr></table></figure><p>只需执行上面的命令，下面的命令可以备用。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -F//清空所有规则</span><br><span class="line">iptables -t nat -vnL POSTROUTING --line-number   //查看nat表</span><br><span class="line">iptables -t nat -D POSTROUTING [num]//删除nat表中postrouting的第一条规则</span><br></pre></td></tr></table></figure></p><p>开启iptables转发</p><p>在/etc/network/if-up.d/目录下创建iptables文件，内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\<span class="comment">#\!/bin/sh</span></span><br><span class="line">iptables-restore &lt; /etc/iptables.pptp</span><br></pre></td></tr></table></figure><p>给脚本添加执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/network/<span class="keyword">if</span>-up.d/iptables</span><br></pre></td></tr></table></figure><p>####7.最后，我们需要重启服务，让配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service pptpd restart</span><br><span class="line">/etc/init.d/pptpd restart</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;若要申请VPS可使用这个&lt;a href=&quot;http://www.digitalocean.com/?refcode=a80753a9aac2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DigtalOcean&lt;/a&gt;，会赠送你$
      
    
    </summary>
    
    
      <category term="VPN" scheme="http://yoursite.com/tags/VPN/"/>
    
  </entry>
  
  <entry>
    <title>git仓库迁移</title>
    <link href="http://yoursite.com/git-change-remote-address/"/>
    <id>http://yoursite.com/git-change-remote-address/</id>
    <published>2016-01-02T08:11:00.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>已有项目名为<code>trainingHub</code></p><p>新的gitlab服务器地址<code>github.com</code></p><p>新的gitlab服务中的User为<code>Skyler</code></p><h3 id="1-第一步"><a href="#1-第一步" class="headerlink" title="1. 第一步"></a>1. 第一步</h3><p>在自己的gitlab后台建立一个新的项目，其地址为<code>git@github.com:Skyler/trainingHub.git</code></p><h3 id="2-第二步"><a href="#2-第二步" class="headerlink" title="2. 第二步"></a>2. 第二步</h3><p>进入本地的<code>trainingHub</code>目录，然后执行下面两个命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote remove origin</span><br><span class="line">git remote add origin git@github.com:Skyler/trainingHub.git</span><br></pre></td></tr></table></figure><h3 id="3-最后直接pull、push"><a href="#3-最后直接pull、push" class="headerlink" title="3. 最后直接pull、push"></a>3. 最后直接<code>pull</code>、<code>push</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote remove origin</span><br><span class="line">git remote add origin git@gitlab.pookor.com:Skyler/trainingHub.git</span><br></pre></td></tr></table></figure><h5 id="若是有多个分支需要迁移"><a href="#若是有多个分支需要迁移" class="headerlink" title="若是有多个分支需要迁移"></a>若是有多个分支需要迁移</h5><p><strong>git remote add <code>branch_name</code> git@gitlab.pookor.com:Skyler/trainingHub.git</strong></p><h5 id="push所有分支"><a href="#push所有分支" class="headerlink" title="push所有分支"></a>push所有分支</h5><p><code>git push --all origin</code></p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>可强制覆盖远程服务器</p><p><code>git push --all --force origin</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;已有项目名为&lt;code&gt;trainingHub&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;新的gitlab服务器地址&lt;code&gt;github.com&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;新的gitlab服务中的User为&lt;code&gt;Skyler&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-第一步&quot;
      
    
    </summary>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Linux(SUSE)Redis服务的安装使用</title>
    <link href="http://yoursite.com/study-redis/"/>
    <id>http://yoursite.com/study-redis/</id>
    <published>2015-05-18T14:42:00.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1、下载源码，解压缩后编译源码。"><a href="#1、下载源码，解压缩后编译源码。" class="headerlink" title="1、下载源码，解压缩后编译源码。"></a>1、下载源码，解压缩后编译源码。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxzf redis-2.8.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-2.8.3</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="2、编译完成后"><a href="#2、编译完成后" class="headerlink" title="2、编译完成后"></a>2、编译完成后</h3><p>有四个可执行文件redis-server、redis-benchmark、redis-cli和redis.conf。然后拷贝到一个目录下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/redis</span><br><span class="line">cp src/redis-server  /usr/redis</span><br><span class="line">cp src/redis-benchmark /usr/redis</span><br><span class="line">cp src/redis-cli  /usr/redis</span><br><span class="line">cp redis.conf  /usr/redis</span><br></pre></td></tr></table></figure><h3 id="3、配置Redis"><a href="#3、配置Redis" class="headerlink" title="3、配置Redis"></a>3、配置Redis</h3><pre><code>vim /usr/redis/redis.conf</code></pre><p>可参考<a href="http://blog.csdn.net/java2000_wl/article/details/8520593" target="_blank" rel="noopener">http://blog.csdn.net/java2000_wl/article/details/8520593</a></p><p>按如下方式修改相关参数：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">端口默认：6379</span><br><span class="line">daemonize yes</span><br><span class="line">timeout 300</span><br><span class="line">tcp-keepalive 60</span><br></pre></td></tr></table></figure><h3 id="4、启动Redis服务"><a href="#4、启动Redis服务" class="headerlink" title="4、启动Redis服务"></a>4、启动Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/redis</span><br><span class="line">./redis-server redis.conf</span><br></pre></td></tr></table></figure><h3 id="5、然后用客户端测试一下是否启动成功"><a href="#5、然后用客户端测试一下是否启动成功" class="headerlink" title="5、然后用客户端测试一下是否启动成功"></a>5、然后用客户端测试一下是否启动成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./redis-cli</span><br><span class="line">$ redis&gt; <span class="built_in">set</span> “<span class="built_in">test</span>” “testredis”</span><br><span class="line">$ OK</span><br><span class="line">$ redis&gt; get “<span class="built_in">test</span>”</span><br><span class="line">$ <span class="string">" testredis "</span></span><br></pre></td></tr></table></figure><h3 id="6-java客户端的使用"><a href="#6-java客户端的使用" class="headerlink" title="6.java客户端的使用"></a>6.java客户端的使用</h3><p>jar包下载地址：<a href="http://download.csdn.net/detail/kuailebeihun/8714073" target="_blank" rel="noopener">http://download.csdn.net/detail/kuailebeihun/8714073</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line"><span class="keyword">import</span> java.util.Set;  </span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> play.Play;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;  </span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;  </span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Redis工具类,用于获取RedisPool. 参考官网说明如下： You shouldn't use the same instance from different threads because you'll have strange errors. And sometimes creating lots of Jedis instances is not good enough because it means lots of sockets and connections, which leads to strange errors as well. A single Jedis instance is not threadsafe! To avoid these problems, you should use JedisPool, which is a threadsafe pool of network connections. This way you can overcome those strange errors and achieve great performance. To use it, init a pool: JedisPool pool = new JedisPool(new JedisPoolConfig(), "localhost"); You can store the pool somewhere statically, it is thread-safe. JedisPoolConfig includes a number of helpful Redis-specific connection pooling defaults. For example, Jedis with JedisPoolConfig will close a connection after 300 seconds if it has not been returned. </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bqwang </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtil</span> </span>&#123;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 私有构造器. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JedisUtil</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 获取连接池. </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接池实例 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JedisPool <span class="title">getPool</span><span class="params">(String ip, <span class="keyword">int</span> port)</span> </span>&#123;  </span><br><span class="line">        JedisPool pool = <span class="keyword">null</span>;  </span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();  </span><br><span class="line">        config.setMaxIdle(Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.maxIdle"</span>)));  </span><br><span class="line">        config.setMaxTotal(Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.maxTotal"</span>)));  </span><br><span class="line">        config.setTestOnBorrow(Play.configuration.getProperty(<span class="string">"redis.pool.testOnBorrow"</span>) == <span class="string">"true"</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>);  </span><br><span class="line">        config.setTestOnReturn(Play.configuration.getProperty(<span class="string">"redis.pool.testOnReturn"</span>) == <span class="string">"true"</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>);  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">/** </span></span><br><span class="line"><span class="comment">             * 如果你遇到 java.net.SocketTimeoutException: Read timed out exception的异常信息 请尝试在构造JedisPool的时候设置自己的超时值. JedisPool默认的超时时间是2秒(单位毫秒) </span></span><br><span class="line"><span class="comment">             */</span>  </span><br><span class="line">            pool = <span class="keyword">new</span> JedisPool(config, ip, port, Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.timeout"</span>)));  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            System.out.println(<span class="string">"get pool:"</span> + e.getMessage() + <span class="string">"==&gt;"</span> + e.getCause().getMessage());  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(<span class="string">"get pool 获取连接池....."</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> pool;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 类级的内部类，也就是静态的成员式内部类，该内部类的实例与外部类的实例 没有绑定关系，而且只有被调用到时才会装载，从而实现了延迟加载。 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtilHolder</span> </span>&#123;  </span><br><span class="line">        <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 静态初始化器，由JVM来保证线程安全 </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> JedisUtil instance = <span class="keyword">new</span> JedisUtil();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 当getInstance方法第一次被调用的时候，它第一次读取 RedisUtilHolder.instance，导致RedisUtilHolder类得到初始化；而这个类在装载并被初始化的时候，会初始化它的静 态域，从而创建RedisUtil的实例，由于是静态的域，因此只会在虚拟机装载类的时候初始化一次，并由虚拟机来保证它的线程安全性。 这个模式的优势在于，getInstance方法并没有被同步，并且只是执行一个域的访问，因此延迟初始化并没有增加任何访问成本。 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisUtil <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> RedisUtilHolder.instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 获取Redis实例. </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Redis工具类实例 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getJedisData</span><span class="params">(String key)</span> </span>&#123;  </span><br><span class="line">        Set&lt;String&gt; resultSet = <span class="keyword">null</span>;  </span><br><span class="line">        JedisPool pool = <span class="keyword">null</span>;  </span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;  </span><br><span class="line">        String ip = Play.configuration.getProperty(<span class="string">"redis.server.ip"</span>);  </span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.server.port"</span>));  </span><br><span class="line">        <span class="comment">// int retryTimes = Integer.parseInt(Play.configuration.getProperty("redis.pool.retryTimes"));  </span></span><br><span class="line">        <span class="comment">// int count = 0;  </span></span><br><span class="line">        <span class="comment">// count++;  </span></span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            pool = getPool(ip, port);  </span><br><span class="line">            jedis = pool.getResource();  </span><br><span class="line">            resultSet = jedis.smembers(key);  </span><br><span class="line">            <span class="comment">// 清空redis中的消息  </span></span><br><span class="line">            jedis.del(key);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            System.out.println(<span class="string">"get jedis:"</span> + e.getMessage() + <span class="string">"==&gt;"</span> + e.getCause().getMessage());  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            <span class="comment">// 销毁对象  </span></span><br><span class="line">            System.out.println(<span class="string">"get Jedis ++++++ 销毁对象"</span>);  </span><br><span class="line">            <span class="keyword">if</span> (pool != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                pool.returnBrokenResource(jedis);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> resultSet;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1、下载源码，解压缩后编译源码。&quot;&gt;&lt;a href=&quot;#1、下载源码，解压缩后编译源码。&quot; class=&quot;headerlink&quot; title=&quot;1、下载源码，解压缩后编译源码。&quot;&gt;&lt;/a&gt;1、下载源码，解压缩后编译源码。&lt;/h3&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Linux(SUSE) nginx反向代理配置，负载均衡</title>
    <link href="http://yoursite.com/study-nginx/"/>
    <id>http://yoursite.com/study-nginx/</id>
    <published>2015-01-01T01:04:00.000Z</published>
    <updated>2017-10-10T15:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-安装jdk"><a href="#1-安装jdk" class="headerlink" title="1. 安装jdk"></a>1. 安装jdk</h3><p>sudo rpm -ivh jdk-7u71-linux-x64.rpm</p><p>设置环境变量：<br>vim /etc/profile</p><p>在底部加入：</p><p><strong>$set java environment</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/usr/java/jdk1.7.0_71</span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure><pre><code>vim /etc/profile.d/java.sh</code></pre><p>加入：</p><p><strong>$set java environment</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/usr/java/jdk1.7.0_71</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/tools.jar</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure><h3 id="2-安装包准备"><a href="#2-安装包准备" class="headerlink" title="2. 安装包准备"></a>2. 安装包准备</h3><p>下载地址：<a href="http://download.csdn.net/detail/kuailebeihun/8318449" target="_blank" rel="noopener">http://download.csdn.net/detail/kuailebeihun/8318449</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf </span><br><span class="line">tar -zxvf nginx-1.7.8.tar.gz</span><br><span class="line">tar -zxvf openssl-1.0.0o.tar.gz </span><br><span class="line">tar -zxvf zlib-1.2.8.tar.gz</span><br></pre></td></tr></table></figure><p>先下载好zlib和openssl<br>编译nginx时，联合编译zlib和openssl</p><h3 id="3-编译安装zlib"><a href="#3-编译安装zlib" class="headerlink" title="3. 编译安装zlib"></a>3. 编译安装zlib</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zlib-1.2.8/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="4-编译安装openssl"><a href="#4-编译安装openssl" class="headerlink" title="4. 编译安装openssl"></a>4. 编译安装openssl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> openssl-1.0.0o/</span><br><span class="line">./config</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="5-编译安装pcre"><a href="#5-编译安装pcre" class="headerlink" title="5. 编译安装pcre"></a>5. 编译安装pcre</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> pcre-8.12/</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="6-联合编译安装nginx"><a href="#6-联合编译安装nginx" class="headerlink" title="6. 联合编译安装nginx"></a>6. 联合编译安装nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> nginx-1.7.8</span><br><span class="line">$ ./configure --user=nobody --group=nobody --prefix=/usr/<span class="built_in">local</span>/webserver/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/moa/pcre-8.12 --with-openssl=/data/moa/openssl-1.0.0o</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>vi objs/Makefile</p><pre><code>查找configure --disable-shared,在1158行,删除./configure --disable-shared, 保存    :st nu可显示行号    :1089直接跳到1158行，:/configure可以搜索make &amp;&amp; make install</code></pre><h3 id="7-nginx配置"><a href="#7-nginx配置" class="headerlink" title="7. nginx配置"></a>7. nginx配置</h3><pre><code>cd /usr/local/webserver/nginx/</code></pre><p>配置</p><pre><code>vim conf/nginx.conf</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">gzip  on;</span><br><span class="line">upstream  wplay &#123;</span><br><span class="line">server 192.168.11.6:80;</span><br><span class="line">&#125;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://wplay;</span><br><span class="line">proxy_redirect     off;</span><br><span class="line">proxy_set_header   Host             $host;</span><br><span class="line">proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class="line">proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">proxy_max_temp_file_size 0;</span><br><span class="line">proxy_connect_timeout      90;</span><br><span class="line">proxy_send_timeout         90;</span><br><span class="line">proxy_read_timeout         90;</span><br><span class="line">proxy_buffer_size          4k;</span><br><span class="line">proxy_buffers              4 32k;</span><br><span class="line">proxy_busy_buffers_size    64k;</span><br><span class="line">proxy_temp_file_write_size 64k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-启动、重启命令"><a href="#8-启动、重启命令" class="headerlink" title="8.启动、重启命令"></a>8.启动、重启命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> sbin/</span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure><p>重启</p><pre><code>nginx -s reload</code></pre><h3 id="9-参考资料"><a href="#9-参考资料" class="headerlink" title="9. 参考资料"></a>9. 参考资料</h3><ul><li><a href="http://blog.csdn.net/superbirds/article/details/7290504" target="_blank" rel="noopener">http://blog.csdn.net/superbirds/article/details/7290504</a></li><li><a href="http://www.bananawolf.com/html/2012/09/831.html" target="_blank" rel="noopener">http://www.bananawolf.com/html/2012/09/831.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-安装jdk&quot;&gt;&lt;a href=&quot;#1-安装jdk&quot; class=&quot;headerlink&quot; title=&quot;1. 安装jdk&quot;&gt;&lt;/a&gt;1. 安装jdk&lt;/h3&gt;&lt;p&gt;sudo rpm -ivh jdk-7u71-linux-x64.rpm&lt;/p&gt;
&lt;p&gt;设置环境
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
  </entry>
  
</feed>
