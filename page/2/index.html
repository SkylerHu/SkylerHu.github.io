<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Skyler&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="No pains, No gains!">
<meta property="og:type" content="website">
<meta property="og:title" content="Skyler&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Skyler&#39;s Blog">
<meta property="og:description" content="No pains, No gains!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skyler&#39;s Blog">
<meta name="twitter:description" content="No pains, No gains!">
  
    <link rel="alternative" href="/atom.xml" title="Skyler&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://7xpdkx.com1.z0.glb.clouddn.com/img/icon/wolf_300.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Skyler Hu</a></h1>
		</hgroup>

		
		<p class="header-subtitle">No pains, No gains!</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/links">链接们</a></li>
	        
				<li><a href="/about">关于</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/SkylerHu" title="github">github</a>
		        
					<a class="facebook" target="_blank" href="https://www.facebook.com/skyler.hulp" title="facebook">facebook</a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Skyler Hu</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://7xpdkx.com1.z0.glb.clouddn.com/img/icon/wolf_300.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Skyler Hu</h1>
			</hgroup>
			
			<p class="header-subtitle">No pains, No gains!</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/links">链接们</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/SkylerHu" title="github">github</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/skyler.hulp" title="facebook">facebook</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Shadowsocks-SwitchySharp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Shadowsocks-SwitchySharp/">Shadowsocks+SwitchySharp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-gcc安装"><a href="#1-gcc安装" class="headerlink" title="1. gcc安装"></a>1. gcc安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:ubuntu-toolchain-r/<span class="built_in">test</span></div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install gcc-4.8</div></pre></td></tr></table></figure>
<h4 id="2-go-环境搭建"><a href="#2-go-环境搭建" class="headerlink" title="2. go 环境搭建"></a>2. go 环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://storage.googleapis.com/golang/go1.4.linux-386.tar.gz</div><div class="line">sudo tar -C /usr/src -xzf go1.4.linux-386.tar.gz</div></pre></td></tr></table></figure>
<p>在 $HOME/.bashrc 文件末添加如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> GOROOT=/usr/src/go</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin</div><div class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go</div></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">source</span> ~/.bashrc</div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$GOROOT</span>/src</div><div class="line">sudo ./all.bash       （若是缺少，apt-get install gccgo-go）</div></pre></td></tr></table></figure>
<h4 id="3-安装git"><a href="#3-安装git" class="headerlink" title="3. 安装git"></a>3. 安装git</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git-core</div></pre></td></tr></table></figure>
<h4 id="4-安装"><a href="#4-安装" class="headerlink" title="4. 安装"></a>4. 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">go get github.com/shadowsocks/shadowsocks-go/cmd/shadowsocks-server</div><div class="line">shadowsocks-go</div></pre></td></tr></table></figure>
<h4 id="5-配置"><a href="#5-配置" class="headerlink" title="5. 配置"></a>5. 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/</div><div class="line">sudo mkdir shadowsocks</div><div class="line"><span class="built_in">cd</span> shadowsocks</div><div class="line">sudo touch config.json</div></pre></td></tr></table></figure>
<h4 id="6-写入"><a href="#6-写入" class="headerlink" title="6. 写入"></a>6. 写入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"server"</span>: <span class="string">"0.0.0.0"</span>,</div><div class="line">  <span class="string">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">  <span class="string">"local_port"</span>: 1080,</div><div class="line">  <span class="string">"timeout"</span>: 300,</div><div class="line">  <span class="string">"method"</span>: <span class="string">"aes-256-cfb"</span>,</div><div class="line">  <span class="string">"fast_open"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="string">"port_password"</span>: &#123;</div><div class="line">    <span class="string">"12345"</span>: <span class="string">"xxx1"</span>,</div><div class="line">    <span class="string">"12346"</span>: <span class="string">"xxx2"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="7-启动关闭"><a href="#7-启动关闭" class="headerlink" title="7. 启动关闭"></a>7. 启动关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">vim .profile</div><div class="line">添加</div><div class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PATH</span>:/root/go/bin"</span></div><div class="line"></div><div class="line"><span class="built_in">source</span> .profile</div><div class="line">shadowsocks-server -c /etc/shadowsocks/config.json <span class="_">-d</span> start</div><div class="line">shadowsocks-server -c /etc/shadowsocks/config.json <span class="_">-d</span> stop</div><div class="line"></div><div class="line">nohup shadowsocks-server -c /etc/shadowsocks/config.json</div></pre></td></tr></table></figure>
<h4 id="8-开机启动"><a href="#8-开机启动" class="headerlink" title="8. 开机启动"></a>8. 开机启动</h4><p>编辑 /etc/rc.local,在exit 0之前</p>
<p><code>/root/go/bin/shadowsocks-server -c /etc/shadowsocks/config.json start</code></p>
<h4 id="9-配置SwitchySharp"><a href="#9-配置SwitchySharp" class="headerlink" title="9. 配置SwitchySharp"></a>9. 配置SwitchySharp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(fbcdn|akamaihd|pixnet)\.net|wretch\.cc|t\.co|goo\.gl|(google(usercontent|apis)*|chrome|staticflickr|imdb|ytimg|gstatic|html5rocks|amazonaws|github|tumblr|addthis|wordpress|blogger|(blog|app)spot|friendfeed|twitter|facebook|youtube|dropbox|feedburner|googleapis|android)\.com</div></pre></td></tr></table></figure>
<p><a href="http://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt" target="_blank" rel="external">http://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt</a> (这个连接404访问不了， 可用下面链接)<br><a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt" target="_blank" rel="external">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Shadowsocks-SwitchySharp/" class="archive-article-date">
  	<time datetime="2016-06-26T10:56:08.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-06-26</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shadowsocks/">Shadowsocks</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Ubuntu-VPN" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Ubuntu-VPN/">Ubuntu搭建VPN</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="分享链接：http-www-digitalocean-com-refcode-a80754a9aac2"><a href="#分享链接：http-www-digitalocean-com-refcode-a80754a9aac2" class="headerlink" title="分享链接：http://www.digitalocean.com/?refcode=a80754a9aac2"></a>分享链接：<a href="http://www.digitalocean.com/?refcode=a80754a9aac2" target="_blank" rel="external">http://www.digitalocean.com/?refcode=a80754a9aac2</a></h3><p>若要申请VPS可使用这个链接，会赠送你10$费用可以购买VPS。</p>
<hr>
<p>采用PPTP搭建VPN，优点是配置简单快捷。将亲身过程记录下来供亲们参考，并将过程中遇到的问题也一一列举出来解决方式。。。</p>
<p>直接上步骤:</p>
<h4 id="1-第一步需要安装PPTP，以用来提供VPN服务"><a href="#1-第一步需要安装PPTP，以用来提供VPN服务" class="headerlink" title="1.第一步需要安装PPTP，以用来提供VPN服务."></a>1.第一步需要安装PPTP，以用来提供VPN服务.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install pptpd</div></pre></td></tr></table></figure>
<p>如果有问题的话比如提示找不到之类的，apt-get update 一下应该就可以了，然后再来一次就会自动完成安装。</p>
<h4 id="2-装好了之后我们需要进行配置一下以让它可以使用"><a href="#2-装好了之后我们需要进行配置一下以让它可以使用" class="headerlink" title="2.装好了之后我们需要进行配置一下以让它可以使用."></a>2.装好了之后我们需要进行配置一下以让它可以使用.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/pptpd.conf</div></pre></td></tr></table></figure>
<p>取消掉以下 2 行的注释：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">localip 192.168.0.1</div><div class="line">remoteip 192.168.0.234-238,192.168.0.245</div></pre></td></tr></table></figure>
<p>分别是通过VPN连接后主机和客户端所使用的IP，可以自行修改。注意这个IP在下面还会用的到。</p>
<h4 id="3-然后我们需要分配账号给自己使用"><a href="#3-然后我们需要分配账号给自己使用" class="headerlink" title="3.然后我们需要分配账号给自己使用."></a>3.然后我们需要分配账号给自己使用.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/ppp/chap-secrets</div></pre></td></tr></table></figure>
<p>这个是用户列表文件</p>
<p>在里面添加账户按如下格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">username  pptpd  <span class="string">"password"</span>  *</div></pre></td></tr></table></figure>
<p><code>username</code>为你的用户名<code>password</code>为你的密码，密码用引号引起,最后的<code>*</code>号表示允许在任意IP连接到服务</p>
<h4 id="4-至此服务弄好了"><a href="#4-至此服务弄好了" class="headerlink" title="4.至此服务弄好了"></a>4.至此服务弄好了</h4><p>如果你sudo service pptpd restart一下，就应该已经能连接到该VPN了，但是连接了之后会发现还访问不了外网。然后我们需要让他能访问外网。首先，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/ppp/pptpd-options</div></pre></td></tr></table></figure>
<p>找到ms-dns，取消掉注释，改成你喜欢的DNS比如8.8.8.8, 8.8.4.4</p>
<h4 id="5-然后我们要开启内核IP转发"><a href="#5-然后我们要开启内核IP转发" class="headerlink" title="5.然后我们要开启内核IP转发"></a>5.然后我们要开启内核IP转发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/sysctl.conf</div></pre></td></tr></table></figure>
<p>取消掉 <code>net.ipv4.ip_forward=1</code> 这一行的注释.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl -p</div></pre></td></tr></table></figure>
<h4 id="6-然后我们需要安装iptables，用来实现请求的NAT转发"><a href="#6-然后我们需要安装iptables，用来实现请求的NAT转发" class="headerlink" title="6.然后我们需要安装iptables，用来实现请求的NAT转发"></a>6.然后我们需要安装iptables，用来实现请求的NAT转发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install iptables</div></pre></td></tr></table></figure>
<p>然后开启NAT转发.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo iptables -t nat -A POSTROUTING <span class="_">-s</span> 192.168.0.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure>
<p>192.168.0.0/24是你在上面设置的IP段，让这个段转发</p>
<p>注意eth0是你连接外网的那块网卡，不一定是0也有可能是1或者看你的机器哪块网卡连的外网了。这样就以NAT的方式请求外网的东西了。不知道你的机器哪块网卡连的外网的话ifconfig一下看看哪个网卡是外网IP就知道了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING <span class="_">-s</span> 192.168.217.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables-save &gt; /etc/iptables.pptp</div></pre></td></tr></table></figure>
<p>只需执行上面的命令，下面的命令可以备用。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">iptables -F	//清空所有规则</div><div class="line">iptables -t nat -vnL POSTROUTING --line-number   //查看nat表</div><div class="line">iptables -t nat -D POSTROUTING [num]	//删除nat表中postrouting的第一条规则</div></pre></td></tr></table></figure></p>
<p>开启iptables转发</p>
<p>在/etc/network/if-up.d/目录下创建iptables文件，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\<span class="comment">#\!/bin/sh</span></div><div class="line">iptables-restore &lt; /etc/iptables.pptp</div></pre></td></tr></table></figure>
<p>给脚本添加执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod +x /etc/network/<span class="keyword">if</span>-up.d/iptables</div></pre></td></tr></table></figure>
<p>####7.最后，我们需要重启服务，让配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo service pptpd restart</div><div class="line">/etc/init.d/pptpd restart</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Ubuntu-VPN/" class="archive-article-date">
  	<time datetime="2016-06-26T10:46:54.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-06-26</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPN/">VPN</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-git-change-remote-address" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/git-change-remote-address/">git仓库迁移</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>已有项目名为<code>trainingHub</code></p>
<p>新的gitlab服务器地址<code>github.com</code></p>
<p>新的gitlab服务中的User为<code>Skyler</code></p>
<h3 id="1-第一步"><a href="#1-第一步" class="headerlink" title="1. 第一步"></a>1. 第一步</h3><p>在自己的gitlab后台建立一个新的项目，其地址为<code>git@github.com:Skyler/trainingHub.git</code></p>
<h3 id="2-第二步"><a href="#2-第二步" class="headerlink" title="2. 第二步"></a>2. 第二步</h3><p>进入本地的<code>trainingHub</code>目录，然后执行下面两个命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git remote remove origin</div><div class="line">git remote add origin git@github.com:Skyler/trainingHub.git</div></pre></td></tr></table></figure>
<h3 id="3-最后直接pull、push"><a href="#3-最后直接pull、push" class="headerlink" title="3. 最后直接pull、push"></a>3. 最后直接<code>pull</code>、<code>push</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git remote remove origin</div><div class="line">git remote add origin git@gitlab.pookor.com:Skyler/trainingHub.git</div></pre></td></tr></table></figure>
<h5 id="若是有多个分支需要迁移"><a href="#若是有多个分支需要迁移" class="headerlink" title="若是有多个分支需要迁移"></a>若是有多个分支需要迁移</h5><p><strong>git remote add <code>branch_name</code> git@gitlab.pookor.com:Skyler/trainingHub.git</strong></p>
<h5 id="push所有分支"><a href="#push所有分支" class="headerlink" title="push所有分支"></a>push所有分支</h5><p><code>git push --all origin</code></p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>可强制覆盖远程服务器</p>
<p><code>git push --all --force origin</code></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/git-change-remote-address/" class="archive-article-date">
  	<time datetime="2016-01-02T08:11:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-01-02</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-study-redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study-redis/">Linux(SUSE)Redis服务的安装使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、下载源码，解压缩后编译源码。"><a href="#1、下载源码，解压缩后编译源码。" class="headerlink" title="1、下载源码，解压缩后编译源码。"></a>1、下载源码，解压缩后编译源码。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar -zxzf redis-2.8.3.tar.gz</div><div class="line"><span class="built_in">cd</span> redis-2.8.3</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="2、编译完成后"><a href="#2、编译完成后" class="headerlink" title="2、编译完成后"></a>2、编译完成后</h3><p>有四个可执行文件redis-server、redis-benchmark、redis-cli和redis.conf。然后拷贝到一个目录下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/redis</div><div class="line">cp src/redis-server  /usr/redis</div><div class="line">cp src/redis-benchmark /usr/redis</div><div class="line">cp src/redis-cli  /usr/redis</div><div class="line">cp redis.conf  /usr/redis</div></pre></td></tr></table></figure>
<h3 id="3、配置Redis"><a href="#3、配置Redis" class="headerlink" title="3、配置Redis"></a>3、配置Redis</h3><pre><code>vim /usr/redis/redis.conf
</code></pre><p>可参考<a href="http://blog.csdn.net/java2000_wl/article/details/8520593" target="_blank" rel="external">http://blog.csdn.net/java2000_wl/article/details/8520593</a></p>
<p>按如下方式修改相关参数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">端口默认：6379</div><div class="line">daemonize yes</div><div class="line">timeout 300</div><div class="line">tcp-keepalive 60</div></pre></td></tr></table></figure>
<h3 id="4、启动Redis服务"><a href="#4、启动Redis服务" class="headerlink" title="4、启动Redis服务"></a>4、启动Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/redis</div><div class="line">./redis-server redis.conf</div></pre></td></tr></table></figure>
<h3 id="5、然后用客户端测试一下是否启动成功"><a href="#5、然后用客户端测试一下是否启动成功" class="headerlink" title="5、然后用客户端测试一下是否启动成功"></a>5、然后用客户端测试一下是否启动成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ./redis-cli</div><div class="line">$ redis&gt; <span class="built_in">set</span> “<span class="built_in">test</span>” “testredis”</div><div class="line">$ OK</div><div class="line">$ redis&gt; get “<span class="built_in">test</span>”</div><div class="line">$ <span class="string">" testredis "</span></div></pre></td></tr></table></figure>
<h3 id="6-java客户端的使用"><a href="#6-java客户端的使用" class="headerlink" title="6.java客户端的使用"></a>6.java客户端的使用</h3><p>jar包下载地址：<a href="http://download.csdn.net/detail/kuailebeihun/8714073" target="_blank" rel="external">http://download.csdn.net/detail/kuailebeihun/8714073</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashMap;  </div><div class="line"><span class="keyword">import</span> java.util.Map;  </div><div class="line"><span class="keyword">import</span> java.util.Set;  </div><div class="line"><span class="keyword">import</span> java.util.logging.Logger;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> play.Play;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;  </div><div class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;  </div><div class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Redis工具类,用于获取RedisPool. 参考官网说明如下： You shouldn't use the same instance from different threads because you'll have strange errors. And sometimes creating lots of Jedis instances is not good enough because it means lots of sockets and connections, which leads to strange errors as well. A single Jedis instance is not threadsafe! To avoid these problems, you should use JedisPool, which is a threadsafe pool of network connections. This way you can overcome those strange errors and achieve great performance. To use it, init a pool: JedisPool pool = new JedisPool(new JedisPoolConfig(), "localhost"); You can store the pool somewhere statically, it is thread-safe. JedisPoolConfig includes a number of helpful Redis-specific connection pooling defaults. For example, Jedis with JedisPoolConfig will close a connection after 300 seconds if it has not been returned. </div><div class="line"> *  </div><div class="line"> * <span class="doctag">@author</span> bqwang </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtil</span> </span>&#123;  </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 私有构造器. </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JedisUtil</span><span class="params">()</span> </span>&#123;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 获取连接池. </div><div class="line">     *  </div><div class="line">     * <span class="doctag">@return</span> 连接池实例 </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JedisPool <span class="title">getPool</span><span class="params">(String ip, <span class="keyword">int</span> port)</span> </span>&#123;  </div><div class="line">        JedisPool pool = <span class="keyword">null</span>;  </div><div class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();  </div><div class="line">        config.setMaxIdle(Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.maxIdle"</span>)));  </div><div class="line">        config.setMaxTotal(Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.maxTotal"</span>)));  </div><div class="line">        config.setTestOnBorrow(Play.configuration.getProperty(<span class="string">"redis.pool.testOnBorrow"</span>) == <span class="string">"true"</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>);  </div><div class="line">        config.setTestOnReturn(Play.configuration.getProperty(<span class="string">"redis.pool.testOnReturn"</span>) == <span class="string">"true"</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>);  </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            <span class="comment">/** </span></div><div class="line">             * 如果你遇到 java.net.SocketTimeoutException: Read timed out exception的异常信息 请尝试在构造JedisPool的时候设置自己的超时值. JedisPool默认的超时时间是2秒(单位毫秒) </div><div class="line">             */  </div><div class="line">            pool = <span class="keyword">new</span> JedisPool(config, ip, port, Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.pool.timeout"</span>)));  </div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </div><div class="line">            System.out.println(<span class="string">"get pool:"</span> + e.getMessage() + <span class="string">"==&gt;"</span> + e.getCause().getMessage());  </div><div class="line">            e.printStackTrace();  </div><div class="line">        &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">            System.out.println(<span class="string">"get pool 获取连接池....."</span>);  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> pool;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 类级的内部类，也就是静态的成员式内部类，该内部类的实例与外部类的实例 没有绑定关系，而且只有被调用到时才会装载，从而实现了延迟加载。 </div><div class="line">     */  </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtilHolder</span> </span>&#123;  </div><div class="line">        <span class="comment">/** </span></div><div class="line">         * 静态初始化器，由JVM来保证线程安全 </div><div class="line">         */  </div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> JedisUtil instance = <span class="keyword">new</span> JedisUtil();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 当getInstance方法第一次被调用的时候，它第一次读取 RedisUtilHolder.instance，导致RedisUtilHolder类得到初始化；而这个类在装载并被初始化的时候，会初始化它的静 态域，从而创建RedisUtil的实例，由于是静态的域，因此只会在虚拟机装载类的时候初始化一次，并由虚拟机来保证它的线程安全性。 这个模式的优势在于，getInstance方法并没有被同步，并且只是执行一个域的访问，因此延迟初始化并没有增加任何访问成本。 </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisUtil <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="keyword">return</span> RedisUtilHolder.instance;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 获取Redis实例. </div><div class="line">     *  </div><div class="line">     * <span class="doctag">@return</span> Redis工具类实例 </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getJedisData</span><span class="params">(String key)</span> </span>&#123;  </div><div class="line">        Set&lt;String&gt; resultSet = <span class="keyword">null</span>;  </div><div class="line">        JedisPool pool = <span class="keyword">null</span>;  </div><div class="line">        Jedis jedis = <span class="keyword">null</span>;  </div><div class="line">        String ip = Play.configuration.getProperty(<span class="string">"redis.server.ip"</span>);  </div><div class="line">        <span class="keyword">int</span> port = Integer.parseInt(Play.configuration.getProperty(<span class="string">"redis.server.port"</span>));  </div><div class="line">        <span class="comment">// int retryTimes = Integer.parseInt(Play.configuration.getProperty("redis.pool.retryTimes"));  </span></div><div class="line">        <span class="comment">// int count = 0;  </span></div><div class="line">        <span class="comment">// count++;  </span></div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            pool = getPool(ip, port);  </div><div class="line">            jedis = pool.getResource();  </div><div class="line">            resultSet = jedis.smembers(key);  </div><div class="line">            <span class="comment">// 清空redis中的消息  </span></div><div class="line">            jedis.del(key);  </div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </div><div class="line">            System.out.println(<span class="string">"get jedis:"</span> + e.getMessage() + <span class="string">"==&gt;"</span> + e.getCause().getMessage());  </div><div class="line">            e.printStackTrace();  </div><div class="line">        &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">            <span class="comment">// 销毁对象  </span></div><div class="line">            System.out.println(<span class="string">"get Jedis ++++++ 销毁对象"</span>);  </div><div class="line">            <span class="keyword">if</span> (pool != <span class="keyword">null</span>) &#123;  </div><div class="line">                pool.returnBrokenResource(jedis);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> resultSet;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/study-redis/" class="archive-article-date">
  	<time datetime="2015-05-18T14:42:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-05-18</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/">Redis</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-study-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study-nginx/">Linux(SUSE) nginx反向代理配置，负载均衡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-安装jdk"><a href="#1-安装jdk" class="headerlink" title="1. 安装jdk"></a>1. 安装jdk</h3><p>sudo rpm -ivh jdk-7u71-linux-x64.rpm</p>
<p>设置环境变量：<br>vim /etc/profile</p>
<p>在底部加入：</p>
<p><strong>$set java environment</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">JAVA_HOME=/usr/java/jdk1.7.0_71</div><div class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME CLASSPATH PATH</div></pre></td></tr></table></figure>
<pre><code>vim /etc/profile.d/java.sh
</code></pre><p>加入：</p>
<p><strong>$set java environment</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">JAVA_HOME=/usr/java/jdk1.7.0_71</div><div class="line">CLASSPATH=.:$JAVA_HOME/lib/tools.jar</div><div class="line">PATH=$JAVA_HOME/bin:$PATH</div><div class="line">export JAVA_HOME CLASSPATH PATH</div></pre></td></tr></table></figure>
<h3 id="2-安装包准备"><a href="#2-安装包准备" class="headerlink" title="2. 安装包准备"></a>2. 安装包准备</h3><p>下载地址：<a href="http://download.csdn.net/detail/kuailebeihun/8318449" target="_blank" rel="external">http://download.csdn.net/detail/kuailebeihun/8318449</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar -zxvf </div><div class="line">tar -zxvf nginx-1.7.8.tar.gz</div><div class="line">tar -zxvf openssl-1.0.0o.tar.gz </div><div class="line">tar -zxvf zlib-1.2.8.tar.gz</div></pre></td></tr></table></figure>
<p>先下载好zlib和openssl<br>编译nginx时，联合编译zlib和openssl</p>
<h3 id="3-编译安装zlib"><a href="#3-编译安装zlib" class="headerlink" title="3. 编译安装zlib"></a>3. 编译安装zlib</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> zlib-1.2.8/</div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>
<h3 id="4-编译安装openssl"><a href="#4-编译安装openssl" class="headerlink" title="4. 编译安装openssl"></a>4. 编译安装openssl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> openssl-1.0.0o/</div><div class="line">./config</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="5-编译安装pcre"><a href="#5-编译安装pcre" class="headerlink" title="5. 编译安装pcre"></a>5. 编译安装pcre</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> pcre-8.12/</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="6-联合编译安装nginx"><a href="#6-联合编译安装nginx" class="headerlink" title="6. 联合编译安装nginx"></a>6. 联合编译安装nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> nginx-1.7.8</div><div class="line">$ ./configure --user=nobody --group=nobody --prefix=/usr/<span class="built_in">local</span>/webserver/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/moa/pcre-8.12 --with-openssl=/data/moa/openssl-1.0.0o</div><div class="line">$ make</div><div class="line">$ make install</div></pre></td></tr></table></figure>
<p>vi objs/Makefile</p>
<pre><code>查找configure --disable-shared,在1158行,删除./configure --disable-shared, 保存
    :st nu可显示行号
    :1089直接跳到1158行，:/configure可以搜索

make &amp;&amp; make install
</code></pre><h3 id="7-nginx配置"><a href="#7-nginx配置" class="headerlink" title="7. nginx配置"></a>7. nginx配置</h3><pre><code>cd /usr/local/webserver/nginx/
</code></pre><p>配置</p>
<pre><code>vim conf/nginx.conf
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">gzip  on;</div><div class="line">	upstream  wplay &#123;</div><div class="line">	server 192.168.11.6:80;</div><div class="line">&#125;</div><div class="line">location / &#123;</div><div class="line">	proxy_pass http://wplay;</div><div class="line">	proxy_redirect     off;</div><div class="line">	proxy_set_header   Host             $host;</div><div class="line">	proxy_set_header   X-Real-IP        $remote_addr;</div><div class="line">	proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</div><div class="line">	proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</div><div class="line">	proxy_max_temp_file_size 0;</div><div class="line">	proxy_connect_timeout      90;</div><div class="line">	proxy_send_timeout         90;</div><div class="line">	proxy_read_timeout         90;</div><div class="line">	proxy_buffer_size          4k;</div><div class="line">	proxy_buffers              4 32k;</div><div class="line">	proxy_busy_buffers_size    64k;</div><div class="line">	proxy_temp_file_write_size 64k;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-启动、重启命令"><a href="#8-启动、重启命令" class="headerlink" title="8.启动、重启命令"></a>8.启动、重启命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ..</div><div class="line"><span class="built_in">cd</span> sbin/</div><div class="line">./nginx</div></pre></td></tr></table></figure>
<p>重启</p>
<pre><code>nginx -s reload
</code></pre><h3 id="9-参考资料"><a href="#9-参考资料" class="headerlink" title="9. 参考资料"></a>9. 参考资料</h3><ul>
<li><a href="http://blog.csdn.net/superbirds/article/details/7290504" target="_blank" rel="external">http://blog.csdn.net/superbirds/article/details/7290504</a></li>
<li><a href="http://www.bananawolf.com/html/2012/09/831.html" target="_blank" rel="external">http://www.bananawolf.com/html/2012/09/831.html</a></li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/study-nginx/" class="archive-article-date">
  	<time datetime="2015-01-01T01:04:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Linux-NFS-mount" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Linux-NFS-mount/">Linux(SUSE) NFS mount挂载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>被mount的机器（服务机）10.10.10.209</p>
<h4 id="1-创建共享文件夹-data-attachment"><a href="#1-创建共享文件夹-data-attachment" class="headerlink" title="1 创建共享文件夹/data/attachment"></a>1 创建共享文件夹/data/attachment</h4><h4 id="2-修改-etc-exports，加入"><a href="#2-修改-etc-exports，加入" class="headerlink" title="2 修改/etc/exports，加入"></a>2 修改/etc/exports，加入</h4><p>/data/attachments 10.10.10.207(rw,no_root_squash,sync,insecure)</p>
<p>多个服务器如下：</p>
<p>/data/attachments 10.10.10.207(rw,no_root_squash,sync,insecure) 10.10.10.208(rw,no_root_squash,sync,insecure)</p>
<h4 id="3-重启相关服务（顺序按下面的进行）"><a href="#3-重启相关服务（顺序按下面的进行）" class="headerlink" title="3 重启相关服务（顺序按下面的进行）"></a>3 重启相关服务（顺序按下面的进行）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">service rpcbind stop</div><div class="line">service nfsserver stop</div><div class="line">service rpcbind start</div><div class="line">service nfsserver start</div></pre></td></tr></table></figure>
<p>mount的机器（客户机）10.10.10.207</p>
<ul>
<li><p>1 创建文件夹/data/attachment</p>
</li>
<li><p>2 修改/etc/fstab，加入<br>10.10.103.209:/data/attachments /data/attachments    nfs    defaults       0 0</p>
</li>
<li><p>3 输入mount -a 使其生效</p>
</li>
<li><p>4 测试–&gt;输入：showmount -e 10.10.103.209，查看本机的共享目录<br>如果输出：<br>Export list for 10.10.103.209:<br>/data/attachments *<br>则测试成功</p>
</li>
</ul>
<h4 id="整体测试"><a href="#整体测试" class="headerlink" title="整体测试"></a>整体测试</h4><p>在服务机/data/attachment下创建文件，如果在客户机下同样目录下出现次文件，说明成功</p>
<p>参考资料</p>
<ul>
<li><a href="http://www.linuxidc.com/Linux/2014-01/95507.htm" target="_blank" rel="external">http://www.linuxidc.com/Linux/2014-01/95507.htm</a></li>
<li><a href="http://blog.csdn.net/liangziyisheng/article/details/10705449" target="_blank" rel="external">http://blog.csdn.net/liangziyisheng/article/details/10705449</a></li>
<li><a href="http://blog.csdn.net/demo_deng/article/details/9568927" target="_blank" rel="external">http://blog.csdn.net/demo_deng/article/details/9568927</a></li>
<li><a href="http://www.2cto.com/os/201201/116103.html" target="_blank" rel="external">http://www.2cto.com/os/201201/116103.html</a></li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Linux-NFS-mount/" class="archive-article-date">
  	<time datetime="2015-01-01T00:55:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NFS/">NFS</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Sencha-multi-langs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Sencha-multi-langs/">Sencha实现国际化，JS动态加载js、css文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>新建文件messages_en.js和messages_zh_CN.js文件；</li>
<li>文件中定义js全局变量 var Messages = {};<br>例：messages_zh_CN.js文件  Messages = {“title”:“标题”};<br>message_en.js文件  Messages = {“title”:“title”};</li>
<li><p>在Sencha应用入口launch : function(){}中，先获取用户的语言，然后通过不同的语言去加载不同的JS文件；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**  </span></div><div class="line">     * 动态加载文件 </div><div class="line">     * @param fileName 文件名(包含后缀名) </div><div class="line">     *      .js:放在js文件夹下;.css:放在css文件夹下 </div><div class="line">     * @param 回调 </div><div class="line">     */  </div><div class="line">    loadJSCSSFile : <span class="function"><span class="keyword">function</span>(<span class="params">fileName, callback</span>)</span>&#123;  </div><div class="line">        <span class="keyword">var</span> fileref = <span class="literal">null</span>;  </div><div class="line">        <span class="keyword">var</span> arr = fileName.split(<span class="string">'.'</span>);  </div><div class="line">        <span class="keyword">switch</span>(arr[arr.length - <span class="number">1</span>]) &#123;  </div><div class="line">        <span class="keyword">case</span> <span class="string">'js'</span>:  </div><div class="line">            fileref = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);  </div><div class="line">            fileref.setAttribute(<span class="string">'type'</span>, <span class="string">'text/javascript'</span>);  </div><div class="line">            fileref.setAttribute(<span class="string">'src'</span>, <span class="string">'js/'</span> + fileName);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> <span class="string">'css'</span>:  </div><div class="line">            fileref = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>);  </div><div class="line">            fileref.setAttribute(<span class="string">'rel'</span>, <span class="string">'stylesheet'</span>);  </div><div class="line">            fileref.setAttribute(<span class="string">'type'</span>, <span class="string">'text/css'</span>);  </div><div class="line">            fileref.setAttribute(<span class="string">'herf'</span>, <span class="string">'css/'</span> + fileName);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">if</span>(fileref != <span class="literal">null</span>) &#123;  </div><div class="line">            <span class="keyword">if</span> (fileref.readyState) &#123; <span class="comment">// IE  </span></div><div class="line">                fileref.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">                    <span class="keyword">if</span> (fileref.readyState == <span class="string">'loaded'</span> || fileref.readyState == <span class="string">'complete'</span>) &#123;  </div><div class="line">                        fileref.onreadystatechange = <span class="literal">null</span>;  </div><div class="line">                        callback();  </div><div class="line">                    &#125;  </div><div class="line">                &#125;;  </div><div class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// Others: Firefox, Safari, Chrome, and Opera  </span></div><div class="line">                fileref.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">                    callback();  </div><div class="line">                &#125;;  </div><div class="line">            &#125;  </div><div class="line">            <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(fileref);  </div><div class="line">        &#125;  </div><div class="line">    &#125;,</div></pre></td></tr></table></figure>
</li>
<li><p>需要国际化的文字都在文件中以(key, value)的形式保存，用的时候，直接Messages.title</p>
</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Sencha-multi-langs/" class="archive-article-date">
  	<time datetime="2015-01-01T00:22:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sencha/">Sencha</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-SOP-in-Java-JS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/SOP-in-Java-JS/">JAVA调用https, JS跨域请求，客户端解决JS跨域问题, SOP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>同源协议 (SOP,Same-Origin-Policy)</code> 可防止从一个来源加载的脚本获取或操纵来自另一来源的文档的属性或方法。术语来源 是域名、应用程序协议和运行脚本文档的端口的结合。可能存在关于 SOP 概念的一些误解；SOP 指只能从站点 A、不能从站点 B 获取信息。您需要知道在 SOP 限制下可以做什么，不可以做什么。</p>
<h3 id="1-JAVA-https请求"><a href="#1-JAVA-https请求" class="headerlink" title="1.JAVA https请求"></a>1.JAVA https请求</h3><p>在做微信服务号的时候出现的问题，解决方法：自定义证书管理器。证书管理器的作用就是让它信任我们指定的证书，意味着信任所有证书，不管是否权威机构颁发，证书有了，通用的https请求方法就不难实现了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.qq.weixin.util;  </div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;  </div><div class="line"><span class="keyword">import</span> java.io.InputStream;  </div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;  </div><div class="line"><span class="keyword">import</span> java.io.OutputStream;  </div><div class="line"><span class="keyword">import</span> java.net.URL;  </div><div class="line"><span class="keyword">import</span> java.security.cert.CertificateException;  </div><div class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> javax.net.ssl.HttpsURLConnection;  </div><div class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;  </div><div class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;  </div><div class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;  </div><div class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;  </div><div class="line">    </div><div class="line"><span class="comment">/**  </span></div><div class="line"> * 公众平台通用接口工具类  </div><div class="line"> *  from==&gt; </div><div class="line"> *      shttp://blog.csdn.net/lyq8479/article/details/9841371 </div><div class="line"> * <span class="doctag">@author</span> liuyq  </div><div class="line"> * <span class="doctag">@date</span> 2013-08-09  </div><div class="line"> */    </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WXHttpUtil</span> </span>&#123;    </div><div class="line">      </div><div class="line">    <span class="comment">/**  </span></div><div class="line">     * 发起https请求并获取结果  </div><div class="line">     *   </div><div class="line">     * <span class="doctag">@param</span> requestUrl 请求地址  </div><div class="line">     * <span class="doctag">@param</span> requestMethod 请求方式（GET、POST）  </div><div class="line">     * <span class="doctag">@param</span> outputStr 提交的数据  </div><div class="line">     * <span class="doctag">@return</span> String  </div><div class="line">     */    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">httpsRequest</span><span class="params">(String requestUrl, String requestMethod, String outputStr)</span> <span class="keyword">throws</span> Exception </span>&#123;    </div><div class="line">        StringBuffer buffer = <span class="keyword">new</span> StringBuffer();    </div><div class="line">        <span class="comment">// 创建SSLContext对象，并使用我们指定的信任管理器初始化    </span></div><div class="line">        TrustManager[] tm = &#123; <span class="keyword">new</span> MyX509TrustManager() &#125;;    </div><div class="line">        SSLContext sslContext = SSLContext.getInstance(<span class="string">"SSL"</span>, <span class="string">"SunJSSE"</span>);    </div><div class="line">        sslContext.init(<span class="keyword">null</span>, tm, <span class="keyword">new</span> java.security.SecureRandom());    </div><div class="line">        <span class="comment">// 从上述SSLContext对象中得到SSLSocketFactory对象    </span></div><div class="line">        SSLSocketFactory ssf = sslContext.getSocketFactory();    </div><div class="line">          </div><div class="line">        URL url = <span class="keyword">new</span> URL(requestUrl);    </div><div class="line">        HttpsURLConnection httpUrlConn = (HttpsURLConnection) url.openConnection();    </div><div class="line">        httpUrlConn.setSSLSocketFactory(ssf);    </div><div class="line">          </div><div class="line">        httpUrlConn.setDoOutput(<span class="keyword">true</span>);    </div><div class="line">        httpUrlConn.setDoInput(<span class="keyword">true</span>);    </div><div class="line">        httpUrlConn.setUseCaches(<span class="keyword">false</span>);    </div><div class="line">        <span class="comment">// 设置请求方式（GET/POST）    </span></div><div class="line">        httpUrlConn.setRequestMethod(requestMethod);    </div><div class="line">          </div><div class="line">        <span class="keyword">if</span> (<span class="string">"GET"</span>.equalsIgnoreCase(requestMethod))    </div><div class="line">            httpUrlConn.connect();    </div><div class="line">          </div><div class="line">        <span class="comment">// 当有数据需要提交时    </span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != outputStr) &#123;  </div><div class="line">            OutputStream outputStream = httpUrlConn.getOutputStream();    </div><div class="line">            <span class="comment">// 注意编码格式，防止中文乱码    </span></div><div class="line">            outputStream.write(outputStr.getBytes(<span class="string">"UTF-8"</span>));    </div><div class="line">            outputStream.close();    </div><div class="line">        &#125;    </div><div class="line">          </div><div class="line">        <span class="comment">// 将返回的输入流转换成字符串    </span></div><div class="line">        InputStream inputStream = httpUrlConn.getInputStream();    </div><div class="line">        InputStreamReader inputStreamReader = <span class="keyword">new</span> InputStreamReader(inputStream, <span class="string">"utf-8"</span>);    </div><div class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(inputStreamReader);    </div><div class="line">          </div><div class="line">        String str = <span class="keyword">null</span>;    </div><div class="line">        <span class="keyword">while</span> ((str = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;    </div><div class="line">            buffer.append(str);    </div><div class="line">        &#125;    </div><div class="line">        bufferedReader.close();    </div><div class="line">        inputStreamReader.close();    </div><div class="line">        <span class="comment">// 释放资源    </span></div><div class="line">        inputStream.close();    </div><div class="line">        inputStream = <span class="keyword">null</span>;    </div><div class="line">        httpUrlConn.disconnect();   </div><div class="line">        String result = buffer.toString();  </div><div class="line">        System.out.println(<span class="string">"请求结果==&gt;"</span> + result);  </div><div class="line">        <span class="keyword">return</span> result;    </div><div class="line">    &#125;    </div><div class="line">      </div><div class="line">    <span class="comment">/**  </span></div><div class="line">     * 证书信任管理器（用于https请求）  </div><div class="line">     *   </div><div class="line">     * <span class="doctag">@author</span> liufeng  </div><div class="line">     * <span class="doctag">@date</span> 2013-08-08  </div><div class="line">     */    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyX509TrustManager</span> <span class="keyword">implements</span> <span class="title">X509TrustManager</span> </span>&#123;    </div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;    </div><div class="line">        &#125;    </div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;    </div><div class="line">        &#125;    </div><div class="line">        </div><div class="line">        <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;    </div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;    </div><div class="line">        &#125;    </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-JS跨域请求"><a href="#2-JS跨域请求" class="headerlink" title="2. JS跨域请求"></a>2. JS跨域请求</h3><p>在网上看了好多方法:</p>
<ul>
<li>1）iframe</li>
<li>2）document.domain</li>
<li>3）window.name</li>
<li>4）script</li>
<li>5）XDomainRequest (IE8+)</li>
<li>6）XMLHTTPRequest (Firefox3.5+)</li>
<li>7）postMessage (HTML5)</li>
<li>8）后台代理</li>
</ul>
<p><strong>本文此处讲解一下JsonP的处理注意事项</strong></p>
<p>JSONP的实现思路很简单</p>
<ul>
<li>1）前端创建script标记，设置src，添加到head中（你可以往body中添加）；</li>
<li>2）后台返回一个js变量jsonp，这个jsonp就是请求后的JSON数据；</li>
<li>3）回调完成后删除script标记（还有一些清理工作如避免部分浏览器内存泄露等）。</li>
</ul>
<p>客户端直接使用JsonP请求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;    </div><div class="line">        <span class="attr">url</span>:<span class="string">"http://crossdomain.com/services.php"</span>,    </div><div class="line">        <span class="attr">dataType</span>:<span class="string">'jsonp'</span>,    </div><div class="line">        <span class="attr">data</span>:<span class="string">''</span>,    </div><div class="line">        <span class="attr">jsonp</span>:<span class="string">'callback'</span>,    </div><div class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;    </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> result) &#123;    </div><div class="line">                alert(i+<span class="string">":"</span>+result[i]);<span class="comment">//循环输出a:1,b:2,etc.    </span></div><div class="line">            &#125;    </div><div class="line">        &#125;,    </div><div class="line">        <span class="attr">timeout</span>:<span class="number">3000</span>    </div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>服务器端处理：(Play Framework写的服务器)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String callback = request.params.get(<span class="string">"callback"</span>);  </div><div class="line">String result = callback + <span class="string">"("</span> + JSON.toJSONString(dataMap) + <span class="string">")"</span>;  </div><div class="line">renderText(result);</div></pre></td></tr></table></figure>
<p>返回时数据用callback+()包上。</p>
<h3 id="3-利用客户端解决方案改进跨域通信"><a href="#3-利用客户端解决方案改进跨域通信" class="headerlink" title="3. 利用客户端解决方案改进跨域通信"></a>3. 利用客户端解决方案改进跨域通信</h3><p><a href="http://www.ibm.com/developerworks/cn/web/wa-crossdomaincomm/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/web/wa-crossdomaincomm/</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/SOP-in-Java-JS/" class="archive-article-date">
  	<time datetime="2014-11-12T01:25:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-11-12</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Play/">Play</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-ViewPage-in-ScrollView" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Android-ViewPage-in-ScrollView/">ScrollView内嵌ViewPager导致ViewPager滑动困难问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>解决方式：重写ScrollView，然后在xml中定义布局的时候，使用自定义的PagerScrollView而不是系统的ScrollView即可。</p>
<p>重点在于重写父类的<code>onInterceptTouchEvent</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.content.Context;  </div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;  </div><div class="line"><span class="keyword">import</span> android.view.GestureDetector;  </div><div class="line"><span class="keyword">import</span> android.view.GestureDetector.SimpleOnGestureListener;  </div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;  </div><div class="line"><span class="keyword">import</span> android.widget.ScrollView;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PagerScrollView</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> GestureDetector mGestureDetector;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PagerScrollView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);  </div><div class="line">        init();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PagerScrollView</span><span class="params">(Context context)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>(context);  </div><div class="line">        init();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PagerScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>(context, attrs);  </div><div class="line">        init();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;  </div><div class="line">        mGestureDetector = <span class="keyword">new</span> GestureDetector(getContext(),  </div><div class="line">                <span class="keyword">new</span> YScrollDetector());  </div><div class="line">        setFadingEdgeLength(<span class="number">0</span>);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev)  </div><div class="line">                &amp;&amp; mGestureDetector.onTouchEvent(ev);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">YScrollDetector</span> <span class="keyword">extends</span> <span class="title">SimpleOnGestureListener</span> </span>&#123;  </div><div class="line">        <span class="meta">@Override</span>  </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onScroll</span><span class="params">(MotionEvent e1, MotionEvent e2,  </span></span></div><div class="line">                <span class="keyword">float</span> distanceX, <span class="keyword">float</span> distanceY) &#123;  </div><div class="line">              </div><div class="line">            <span class="keyword">if</span> (Math.abs(distanceY) &gt;= Math.abs(distanceX)) &#123;  </div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Android-ViewPage-in-ScrollView/" class="archive-article-date">
  	<time datetime="2014-08-08T12:08:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-08-08</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-Manage-Activity-Service" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Android-Manage-Activity-Service/">Android自己管理Activity和Service</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>在一些特殊情况下，我们需要对Activity Task进行管理。</p>
</blockquote>
<p>当然，我们最好还是不要自己去控制，以免发生一些不必要的麻烦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.anjoyo.musicplayer.util;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> java.util.List;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> android.app.ActivityManager;  </div><div class="line"><span class="keyword">import</span> android.content.ComponentName;  </div><div class="line"><span class="keyword">import</span> android.content.Context;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextManagerUtil</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="comment">/**  </span></div><div class="line">     * <span class="doctag">@param</span> context 上下文 </div><div class="line">     * <span class="doctag">@param</span> className 服务类的名称 </div><div class="line">     * <span class="doctag">@return</span> 返回服务是否还在后台运行 </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isServiceRunning</span><span class="params">(Context context,Class&lt;?&gt; obj)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        <span class="keyword">boolean</span> isRunning = <span class="keyword">false</span>;  </div><div class="line">        ActivityManager activityManager = (ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);   </div><div class="line">        List&lt;ActivityManager.RunningServiceInfo&gt; serviceList = activityManager.getRunningServices(<span class="number">30</span>);  </div><div class="line">  </div><div class="line">        <span class="keyword">if</span> (!(serviceList.size()&gt;<span class="number">0</span>)) &#123;  </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;serviceList.size(); i++) &#123;  </div><div class="line">            <span class="keyword">if</span> (serviceList.get(i).service.getClassName().equals(obj.getName()) == <span class="keyword">true</span>) &#123;  </div><div class="line">                isRunning = <span class="keyword">true</span>;  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> isRunning;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    <span class="comment">/**  </span></div><div class="line">     * 返回本程序中Task中顶端的Activity </div><div class="line">     * <span class="doctag">@param</span> context </div><div class="line">     * <span class="doctag">@return</span>  </div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ComponentName <span class="title">getTopActivity</span><span class="params">(Context context)</span> </span>&#123;  </div><div class="line">        <span class="comment">//需要android.permission.GET_TASKS权限  </span></div><div class="line">        ActivityManager activityManager = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);  </div><div class="line">        <span class="keyword">int</span> maxNum = <span class="number">10</span>;<span class="comment">//获取的正在运行的activity的最大数量  </span></div><div class="line">        List&lt;ActivityManager.RunningTaskInfo&gt; runningTasks = activityManager.getRunningTasks(maxNum);  </div><div class="line">        <span class="keyword">for</span> (ActivityManager.RunningTaskInfo runningTaskInfo : runningTasks) &#123;  </div><div class="line">            ComponentName componentName = runningTaskInfo.topActivity;  </div><div class="line">            <span class="keyword">if</span> (componentName != <span class="keyword">null</span> &amp;&amp; componentName.getClassName().startsWith(<span class="string">"com.anjoyo.musicplayer"</span>)) &#123;  </div><div class="line">                <span class="keyword">return</span> componentName;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/Android-Manage-Activity-Service/" class="archive-article-date">
  	<time datetime="2014-07-25T00:56:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-07-25</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Skyler Hu
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/"
	}
</script>

<script src="/./main.js"></script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a2503cc9e29eba24d28584a7506f1eab";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/DataStructure/" style="font-size: 10px;">DataStructure</a> <a href="/tags/GitHub/" style="font-size: 10px;">GitHub</a> <a href="/tags/Java/" style="font-size: 12.5px;">Java</a> <a href="/tags/Jekyll/" style="font-size: 10px;">Jekyll</a> <a href="/tags/Linux/" style="font-size: 17.5px;">Linux</a> <a href="/tags/MQTT/" style="font-size: 12.5px;">MQTT</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Play/" style="font-size: 10px;">Play</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Sencha/" style="font-size: 15px;">Sencha</a> <a href="/tags/Shadowsocks/" style="font-size: 12.5px;">Shadowsocks</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 12.5px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/mosquitto/" style="font-size: 12.5px;">mosquitto</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/owncloud/" style="font-size: 10px;">owncloud</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a>
    			</div>
    	</section>
    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>